/**
 * skylark-utils-codec - The codec features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(e,t){var n=t.define,r=t.require,i="function"==typeof n&&n.amd,s=!i&&"undefined"!=typeof exports;if(!i&&!n){var a={};n=t.define=function(e,t,n){"function"==typeof n?(a[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),r=e.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}(t,e)}),exports:null},r(e)):a[e]=n},r=t.require=function(e){if(!a.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var n=a[e];if(!n.exports){var i=[];n.deps.forEach(function(e){i.push(r(e))}),n.exports=n.factory.apply(t,i)}return n.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,t){e("skylark-utils-codec/codec",["skylark-langx/skylark","skylark-langx/langx"],function(e,t){var n=e.codec={};return n}),e("skylark-utils-codec/base64",["skylark-langx/langx","./codec"],function(e,t){var n=function(){return n},r="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";return n.encode=function(e){for(var t=[],n=e.length,s=n%3,a=n-s,o=0;o<a;){var h=e[o++]<<16|e[o++]<<8|e[o++];t.push(i.charAt(h>>>18&63)),t.push(i.charAt(h>>>12&63)),t.push(i.charAt(h>>>6&63)),t.push(i.charAt(63&h))}switch(s){case 2:var h=e[o++]<<16|e[o++]<<8;t.push(i.charAt(h>>>18&63)),t.push(i.charAt(h>>>12&63)),t.push(i.charAt(h>>>6&63)),t.push(r);break;case 1:var h=e[o++]<<16;t.push(i.charAt(h>>>18&63)),t.push(i.charAt(h>>>12&63)),t.push(r),t.push(r)}return t.join("")},n.decode=function(e){for(var t=e.split(""),n=[],s=t.length;t[--s]==r;);for(var a=0;a<s;){var o=i.indexOf(t[a++])<<18;a<=s&&(o|=i.indexOf(t[a++])<<12),a<=s&&(o|=i.indexOf(t[a++])<<6),a<=s&&(o|=i.indexOf(t[a++])),n.push(o>>>16&255),n.push(o>>>8&255),n.push(255&o)}for(;0==n[n.length-1];)n.pop();return n},t.base64=n}),e("skylark-utils-codec/jbig2",["skylark-langx/langx","skylark-utils-stream/DecodeStream","./codec"],function(e,t,n){"use strict";var r=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}],i=e.klass({klassName:"ArithmeticDecoder",byteIn:function(){var e=this.data,t=this.bp;if(255==e[t]){var n=e[t+1];n>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,t){var n,i=e[t]>>1,s=1&e[t],a=r[i],o=a.qe,h=a.nmps,l=a.nlps,c=a.switchFlag;if(this.a-=o,this.chigh<o)this.a<o?(this.a=o,n=s,i=h):(this.a=o,n=1-s,c&&(s=n),i=l);else{if(this.chigh-=o,0!=(32768&this.a))return s;this.a<o?(n=1-s,c&&(s=n),i=l):(n=s,i=h)}do{0===this.ct&&this.byteIn(),this.a<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&this.a));return e[t]=i<<1|s,n},init:function(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}}),s=e.klass({getContexts:function(e){return e in this?this[e]:this[e]=new Int8Array(65536)}}),a=e.klass({decoder:{get:function(){var e=new i(this.data,this.start,this.end);return shadow(this,"decoder",e)}},contextCache:{get:function(){var e=new s;return shadow(this,"contextCache",e)}},init:function(e,t,n){this.data=e,this.start=t,this.end=n}});function o(e,t,n){for(var r,i=e.getContexts(t),s=1,a=1,o=0,h=32,l=4436;a;){var c=n.readBit(i,s);switch(s=s<256?s<<1|c:511&(s<<1|c)|256,a){case 1:r=!!c;break;case 2:if(c)break;a=7,h=2,l=0;break;case 3:if(c)break;a=7,h=4,l=4;break;case 4:if(c)break;a=7,h=6,l=20;break;case 5:if(c)break;a=7,h=8,l=84;break;case 6:if(c)break;a=7,h=12,l=340;break;default:o=2*o+c,0==--h&&(a=0);continue}a++}return o+=l,r?o>0?-o:null:o}function h(e,t,n){for(var r=e.getContexts("IAID"),i=1,s=0;s<n;s++){var a=t.readBit(r,i);i=2*i+a}return n<31?i&(1<<n)-1:i-Math.pow(2,n)}var l=["SymbolDictionary",null,null,null,"IntermediateTextRegion",null,"ImmediateTextRegion","ImmediateLosslessTextRegion",null,null,null,null,null,null,null,null,"patternDictionary",null,null,null,"IntermediateHalftoneRegion",null,"ImmediateHalftoneRegion","ImmediateLosslessHalftoneRegion",null,null,null,null,null,null,null,null,null,null,null,null,"IntermediateGenericRegion",null,"ImmediateGenericRegion","ImmediateLosslessGenericRegion","IntermediateGenericRefinementRegion",null,"ImmediateGenericRefinementRegion","ImmediateLosslessGenericRefinementRegion",null,null,null,null,"PageInformation","EndOfPage","EndOfStripe","EndOfFile","Profiles","Tables",null,null,null,null,null,null,null,null,"Extension"],c=[[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:2,y:-1},{x:-4,y:0},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}],[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:2,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:2,y:-1},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}],[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-2,y:0},{x:-1,y:0}],[{x:-3,y:-1},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-4,y:0},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}]],f=[{coding:[{x:0,y:-1},{x:1,y:-1},{x:-1,y:0}],reference:[{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}]},{coding:[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0}],reference:[{x:0,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]}],u=[7379,1946,227,395],p=[32,8];function m(e){for(var t=1,n=0;e>t;)t<<=1,n++;return n}function g(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function v(e,t){var n=g(e,t);return 2147483648&n?n+4294967296:n}function d(e,t){return e[t]<<8|e[t+1]}function w(e,t){return e[t]<<24>>24}function b(e,t,n,r,i,s,a,o){e&&error("JBIG2 error: MMR encoding is not supported");for(var h=!!s,l=c[r].concat(a),f=l.length,p=new Int32Array(f),m=new Int32Array(f),g=0;g<f;g++)p[g]=l[g].x,m[g]=l[g].y;for(var v=u[r],d=[],w=o.decoder,b=o.contextCache.getContexts("GB"),x=0,y=0;y<n;y++){if(i){var k=w.readBit(b,v);x^=k}if(x)d.push(d[d.length-1]);else{var F=new Uint8Array(t);d.push(F);for(var q=0;q<t;q++)if(h&&s[y][q])F[q]=0;else{for(var I=0,g=0;g<f;g++){var A=y+m[g],C=q+p[g];A<0||C<0||C>=t?I<<=1:I=I<<1|d[A][C]}var D=w.readBit(b,I);F[q]=D}}}return d}function x(e,t,n,r,i,s,a,o,h){var l=f[n].coding;0===n&&(l=l.concat([o[0]]));for(var c=l.length,u=new Int32Array(c),m=new Int32Array(c),g=0;g<c;g++)u[g]=l[g].x,m[g]=l[g].y;var v=f[n].reference;0===n&&(v=v.concat([o[1]]));for(var d=v.length,w=new Int32Array(d),b=new Int32Array(d),g=0;g<d;g++)w[g]=v[g].x,b[g]=v[g].y;for(var x=r[0].length,y=r.length,k=p[n],F=[],q=h.decoder,I=h.contextCache.getContexts("GR"),A=0,C=0;C<t;C++){if(a){var D=q.readBit(I,k);A^=D}var L=new Uint8Array(e);F.push(L);for(var S=0;S<e;S++){A&&error("JBIG2 error: prediction is not supported");for(var B=0,g=0;g<c;g++){var T=C+m[g],R=S+u[g];T<0||R<0||R>=e?B<<=1:B=B<<1|F[T][R]}for(var g=0;g<d;g++){var T=C+b[g]+s,R=S+w[g]+i;T<0||T>=y||R<0||R>=x?B<<=1:B=B<<1|r[T][R]}var P=q.readBit(I,B);L[S]=P}}return F}function y(e,t){var n={};n.number=v(e,t);var r=e[t+4],i=63&r;l[i]||error("JBIG2 error: invalid segment type: "+i),n.type=i,n.typeName=l[i],n.deferredNonRetain=!!(128&r);var s=!!(64&r),a=e[t+5],o=a>>5&7,h=[31&a],c=t+6;if(7==a){o=536870911&g(e,c-1),c+=3;var f=o+7>>3;for(h[0]=e[c++];--f>0;)h.push(e[c++])}else 5!=a&&6!=a||error("JBIG2 error: invalid referred-to flags");n.retainBits=h;for(var u=n.number<=256?1:n.number<=65536?2:4,p=[],m=0;m<o;m++){var w=1==u?e[c]:2==u?d(e,c):v(e,c);p.push(w),c+=u}if(n.referredTo=p,s?(n.pageAssociation=v(e,c),c+=4):n.pageAssociation=e[c++],n.length=v(e,c),c+=4,4294967295==n.length)if(38===i){var b=F(e,c),x=e[c+q],y=!!(1&x),k=new Uint8Array(6);y||(k[0]=255,k[1]=172),k[2]=b.height>>>24&255,k[3]=b.height>>16&255,k[4]=b.height>>8&255,k[5]=255&b.height;for(var m=c,I=e.length;m<I;m++){for(var A=0;A<6&&k[A]===e[m+A];)A++;if(6==A){n.length=m+6;break}}4294967295==n.length&&error("JBIG2 error: segment end was not found")}else error("JBIG2 error: invalid unknown segment length");return n.headerEnd=c,n}function k(e,t,n,r){for(var i=[],s=n;s<r;){var a=y(t,s);s=a.headerEnd;var o={header:a,data:t};if(e.randomAccess||(o.start=s,s+=a.length,o.end=s),i.push(o),51==a.type)break}if(e.randomAccess)for(var h=0,l=i.length;h<l;h++)i[h].start=s,s+=i[h].header.length,i[h].end=s;return i}function F(e,t){return{width:v(e,t),height:v(e,t+4),x:v(e,t+8),y:v(e,t+12),combinationOperator:7&e[t+16]}}var q=17;function I(e,t){var n,r=e.header,i=e.data,s=e.start,a=e.end;switch(r.type){case 0:var o={},h=d(i,s);if(o.huffman=!!(1&h),o.refinement=!!(2&h),o.huffmanDHSelector=h>>2&3,o.huffmanDWSelector=h>>4&3,o.bitmapSizeSelector=h>>6&1,o.aggregationInstancesSelector=h>>7&1,o.bitmapCodingContextUsed=!!(256&h),o.bitmapCodingContextRetained=!!(512&h),o.template=h>>10&3,o.refinementTemplate=h>>12&1,s+=2,!o.huffman){for(var l=0===o.template?4:1,c=[],f=0;f<l;f++)c.push({x:w(i,s),y:w(i,s+1)}),s+=2;o.at=c}if(o.refinement&&!o.refinementTemplate){for(var c=[],f=0;f<2;f++)c.push({x:w(i,s),y:w(i,s+1)}),s+=2;o.refinementAt=c}o.numberOfExportedSymbols=v(i,s),s+=4,o.numberOfNewSymbols=v(i,s),s+=4,n=[o,r.number,r.referredTo,i,s,a];break;case 6:case 7:var u={};u.info=F(i,s);var p=d(i,s+=q);if(s+=2,u.huffman=!!(1&p),u.refinement=!!(2&p),u.stripSize=1<<(p>>2&3),u.referenceCorner=p>>4&3,u.transposed=!!(64&p),u.combinationOperator=p>>7&3,u.defaultPixelValue=p>>9&1,u.dsOffset=p<<17>>27,u.refinementTemplate=p>>15&1,u.huffman){var m=d(i,s);s+=2,u.huffmanFS=3&m,u.huffmanDS=m>>2&3,u.huffmanDT=m>>4&3,u.huffmanRefinementDW=m>>6&3,u.huffmanRefinementDH=m>>8&3,u.huffmanRefinementDX=m>>10&3,u.huffmanRefinementDY=m>>12&3,u.huffmanRefinementSizeSelector=!!(14&m)}if(u.refinement&&!u.refinementTemplate){for(var c=[],f=0;f<2;f++)c.push({x:w(i,s),y:w(i,s+1)}),s+=2;u.refinementAt=c}u.numberOfSymbolInstances=v(i,s),s+=4,u.huffman&&error("JBIG2 error: huffman is not supported"),n=[u,r.referredTo,i,s,a];break;case 38:case 39:var g={};g.info=F(i,s),s+=q;var b=i[s++];if(g.mmr=!!(1&b),g.template=b>>1&3,g.prediction=!!(8&b),!g.mmr){for(var l=0===g.template?4:1,c=[],f=0;f<l;f++)c.push({x:w(i,s),y:w(i,s+1)}),s+=2;g.at=c}n=[g,i,s,a];break;case 48:var x={width:v(i,s),height:v(i,s+4),resolutionX:v(i,s+8),resolutionY:v(i,s+12)};4294967295==x.height&&delete x.height;var y=i[s+16];d(i,s+17);x.lossless=!!(1&y),x.refinement=!!(2&y),x.defaultPixelValue=y>>2&1,x.combinationOperator=y>>3&3,x.requiresBuffer=!!(32&y),x.combinationOperatorOverride=!!(64&y),n=[x];break;case 49:case 50:case 51:case 62:break;default:error("JBIG2 error: segment type "+r.typeName+"("+r.type+") is not implemented")}var k="on"+r.typeName;k in t&&t[k].apply(t,n)}function A(e,t){for(var n=0,r=e.length;n<r;n++)I(e[n],t)}var C=e.klass({onPageInformation:function(e){this.currentPageInfo=e;for(var t=e.width+7>>3,n=new Uint8Array(t*e.height),r=e.defaultPixelValue?255:0,i=0,s=n.length;i<s;i++)n[i]=r;this.buffer=n},drawBitmap:function(e,t){for(var n=this.currentPageInfo,r=e.width,i=e.height,s=n.width+7>>3,a=n.combinationOperatorOverride?e.combinationOperator:n.combinationOperator,o=this.buffer,h=0;h<i;h++){var l=128>>(7&e.x),c=(h+e.y)*s+(e.x>>3);switch(a){case 0:for(var f=0;f<r;f++)o[c]|=t[h][f]?l:0,(l>>=1)||(l=128,c++);break;case 2:for(var f=0;f<r;f++)o[c]^=t[h][f]?l:0,(l>>=1)||(l=128,c++);break;default:error("JBIG2 error: operator "+a+" is not supported")}}},onImmediateGenericRegion:function(e,t,n,r){var i=e.info,s=new a(t,n,r),o=b(e.mmr,i.width,i.height,e.template,e.prediction,null,e.at,s);this.drawBitmap(i,o)},onImmediateLosslessGenericRegion:function(){this.onImmediateGenericRegion.apply(this,arguments)},onSymbolDictionary:function(e,t,n,r,i,s){e.huffman&&error("JBIG2 error: huffman is not supported");var l=this.symbols;l||(this.symbols=l={});for(var c=[],f=0,u=n.length;f<u;f++)c=c.concat(l[n[f]]);var p=new a(r,i,s);l[t]=function(e,t,n,r,i,s,a,l,c,f,u){e&&error("JBIG2 error: huffman is not supported");var p=[],g=0,v=m(n.length+r),d=u.decoder,w=u.contextCache;for(;p.length<r;){var y=o(w,"IADH",d);g+=y;for(var k=0;;){var F,q=o(w,"IADW",d);if(null===q)break;if(k+=q,t){var I=o(w,"IAAI",d);I>1&&error("JBIG2 error: number of instances > 1 is not supported");var A=h(w,d,v),C=o(w,"IARDX",d),D=o(w,"IARDY",d),L=A<n.length?n[A]:p[A-n.length];F=x(k,g,c,L,C,D,!1,f,u)}else F=b(!1,k,g,a,!1,null,l,u);p.push(F)}}var S=[],B=[],T=!1,R=n.length+r;for(;B.length<R;){for(var P=o(w,"IAEX",d);P--;)B.push(T);T=!T}for(var G=0,M=n.length;G<M;G++)B[G]&&S.push(n[G]);for(var J=0;J<r;G++,J++)B[G]&&S.push(p[J]);return S}(e.huffman,e.refinement,c,e.numberOfNewSymbols,e.numberOfExportedSymbols,0,e.template,e.at,e.refinementTemplate,e.refinementAt,p)},onImmediateTextRegion:function(e,t,n,r,i){for(var s=e.info,l=this.symbols,c=[],f=0,u=t.length;f<u;f++)c=c.concat(l[t[f]]);var p=m(c.length),g=new a(n,r,i),v=function(e,t,n,r,i,s,a,l,c,f,u,p,m,g,v,d,w){e&&error("JBIG2 error: huffman is not supported");for(var b=[],y=0;y<r;y++){var k=new Uint8Array(n);if(i)for(var F=0;F<n;F++)k[F]=i;b.push(k)}var q=w.decoder,I=w.contextCache,A=-o(I,"IADT",q),C=0,y=0;for(;y<s;){var D=o(I,"IADT",q);A+=D;for(var L=o(I,"IAFS",q),S=C+=L;;){var B=1==a?0:o(I,"IAIT",q),T=a*A+B,R=h(I,q,c),P=t&&o(I,"IARI",q),G=l[R],M=G[0].length,J=G.length;if(P){var O=o(I,"IARDW",q),U=o(I,"IARDH",q),E=o(I,"IARDX",q),j=o(I,"IARDY",q);G=x(M+=O,J+=U,v,G,(O>>1)+E,(U>>1)+j,!1,d,w)}var N=T-(1&p?0:J),H=S-(2&p?M:0);if(f){for(var V=0;V<J;V++){var k=b[H+V];if(k){var Y=G[V],_=Math.min(n-N,M);switch(m){case 0:for(var z=0;z<_;z++)k[N+z]|=Y[z];break;case 2:for(var z=0;z<_;z++)k[N+z]^=Y[z];break;default:error("JBIG2 error: operator "+m+" is not supported")}}}S+=J-1}else{for(var z=0;z<J;z++){var k=b[N+z];if(k){var Y=G[z];switch(m){case 0:for(var V=0;V<M;V++)k[H+V]|=Y[V];break;case 2:for(var V=0;V<M;V++)k[H+V]^=Y[V];break;default:error("JBIG2 error: operator "+m+" is not supported")}}}S+=M-1}y++;var X=o(I,"IADS",q);if(null===X)break;S+=X+u}}return b}(e.huffman,e.refinement,s.width,s.height,e.defaultPixelValue,e.numberOfSymbolInstances,e.stripSize,c,p,e.transposed,e.dsOffset,e.referenceCorner,e.combinationOperator,0,e.refinementTemplate,e.refinementAt,g);this.drawBitmap(s,v)},onImmediateLosslessTextRegion:function(){this.onImmediateTextRegion.apply(this,arguments)}}),D=e.klass({parseChunks:function(e){return function(e){for(var t=new C,n=0,r=e.length;n<r;n++){var i=e[n],s=k({},i.data,i.start,i.end);A(s,t)}return t.buffer}(e)}}),L=t.inherit({klassName:"Jbig2Stream",init:function(e,t){this.dict=t,this.bytes=e,this.overrided()},ensureBuffer:function(e){if(!this.bufferLength){var t=new D,n=[],r=this.dict.get("DecodeParms");if(r&&r.has("JBIG2Globals")){var i=r.get("JBIG2Globals"),s=i.getBytes();n.push({data:s,start:0,end:s.length})}n.push({data:this.bytes,start:0,end:this.bytes.length});for(var a=t.parseChunks(n),o=a.length,h=0;h<o;h++)a[h]^=255;this.buffer=a,this.bufferLength=o}},getChar:function(){error("internal error: getChar is not valid on Jbig2Stream")}});return n.jbig2={Jbig2Image:D,Jbig2Stream:L}}),e("skylark-utils-codec/jpeg",["skylark-langx/langx","skylark-utils-stream/DecodeStream","./codec"],function(e,t,n){"use strict";var r=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,s=799,a=3406,o=2276,h=1567,l=3784,c=5793,f=2896;function u(e,t){for(var n,r,i=0,s=[],a=16;a>0&&!e[a-1];)a--;s.push({children:[],index:0});var o,h=s[0];for(n=0;n<a;n++){for(r=0;r<e[n];r++){for((h=s.pop()).children[h.index]=t[i];h.index>0;)h=s.pop();for(h.index++,s.push(h);s.length<=n;)s.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o;i++}n+1<a&&(s.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o)}return s[0].children}function p(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function m(e,t,n,i,s,a,o,h,l){n.precision,n.samplesPerLine,n.scanLines;var c=n.mcusPerLine,f=n.progressive,u=(n.maxH,n.maxV,t),m=0,g=0;function v(){if(g>0)return m>>--g&1;if(255===(m=e[t++])){var n=e[t++];if(n)throw"unexpected marker: "+(m<<8|n).toString(16)}return g=7,m>>>7}function d(e){for(var t=e;;){if("number"==typeof(t=t[v()]))return t;if("object"!=typeof t)throw"invalid huffman sequence"}}function w(e){for(var t=0;e>0;)t=t<<1|v(),e--;return t}function b(e){if(1===e)return 1===v()?1:-1;var t=w(e);return t>=1<<e-1?t:t+(-1<<e)+1}var x=0;var y,k=0;function F(e,t,n,r,i){var s=n/c|0,a=n%c,o=s*e.v+r,h=a*e.h+i,l=p(e,o,h);t(e,l)}function q(e,t,n){var r=n/e.blocksPerLine|0,i=n%e.blocksPerLine,s=p(e,r,i);t(e,s)}var I,A,C,D,L,S,B=i.length;S=f?0===a?0===h?function(e,t){var n=d(e.huffmanTableDC),r=0===n?0:b(n)<<l;e.blockData[t]=e.pred+=r}:function(e,t){e.blockData[t]|=v()<<l}:0===h?function(e,t){if(x>0)return void x--;var n=a,i=o;for(;n<=i;){var s=d(e.huffmanTableAC),h=15&s,c=s>>4;if(0!==h){var f=r[n+=c];e.blockData[t+f]=b(h)*(1<<l),n++}else{if(c<15){x=w(c)+(1<<c)-1;break}n+=16}}}:function(e,t){var n,i,s=a,h=o,c=0;for(;s<=h;){var f=r[s];switch(k){case 0:if(i=d(e.huffmanTableAC),c=i>>4,0===(n=15&i))c<15?(x=w(c)+(1<<c),k=4):(c=16,k=1);else{if(1!==n)throw"invalid ACn encoding";y=b(n),k=c?2:3}continue;case 1:case 2:e.blockData[t+f]?e.blockData[t+f]+=v()<<l:0===--c&&(k=2===k?3:0);break;case 3:e.blockData[t+f]?e.blockData[t+f]+=v()<<l:(e.blockData[t+f]=y<<l,k=0);break;case 4:e.blockData[t+f]&&(e.blockData[t+f]+=v()<<l)}s++}4===k&&0===--x&&(k=0)}:function(e,t){var n=d(e.huffmanTableDC),i=0===n?0:b(n);e.blockData[t]=e.pred+=i;var s=1;for(;s<64;){var a=d(e.huffmanTableAC),o=15&a,h=a>>4;if(0!==o){var l=r[s+=h];e.blockData[t+l]=b(o),s++}else{if(h<15)break;s+=16}}};var T,R,P,G,M=0;for(R=1===B?i[0].blocksPerLine*i[0].blocksPerColumn:c*n.mcusPerColumn,s||(s=R);M<R;){for(A=0;A<B;A++)i[A].pred=0;if(x=0,1===B)for(I=i[0],L=0;L<s;L++)q(I,S,M),M++;else for(L=0;L<s;L++){for(A=0;A<B;A++)for(I=i[A],P=I.h,G=I.v,C=0;C<G;C++)for(D=0;D<P;D++)F(I,S,M,C,D);M++}if(g=0,(T=e[t]<<8|e[t+1])<=65280)throw"marker was not found";if(!(T>=65488&&T<=65495))break;t+=2}return t-u}function g(e,t,n){for(var r,u,p,m,g,v,d,w,b,x,y,k,F,q,I,A,C,D=e.quantizationTable,L=e.blockData,S=0;S<64;S+=8)b=L[t+S],x=L[t+S+1],y=L[t+S+2],k=L[t+S+3],F=L[t+S+4],q=L[t+S+5],I=L[t+S+6],A=L[t+S+7],b*=D[S],0!=(x|y|k|F|q|I|A)?(x*=D[S+1],y*=D[S+2],k*=D[S+3],F*=D[S+4],q*=D[S+5],I*=D[S+6],A*=D[S+7],u=(r=(r=c*b+128>>8)+(u=c*F+128>>8)+1>>1)-u,C=(p=y)*l+(m=I)*h+128>>8,p=p*h-m*l+128>>8,d=(g=(g=f*(x-A)+128>>8)+(d=q<<4)+1>>1)-d,v=(w=(w=f*(x+A)+128>>8)+(v=k<<4)+1>>1)-v,m=(r=r+(m=C)+1>>1)-m,p=(u=u+p+1>>1)-p,C=g*o+w*a+2048>>12,g=g*a-w*o+2048>>12,w=C,C=v*s+d*i+2048>>12,v=v*i-d*s+2048>>12,d=C,n[S]=r+w,n[S+7]=r-w,n[S+1]=u+d,n[S+6]=u-d,n[S+2]=p+v,n[S+5]=p-v,n[S+3]=m+g,n[S+4]=m-g):(C=c*b+512>>10,n[S]=C,n[S+1]=C,n[S+2]=C,n[S+3]=C,n[S+4]=C,n[S+5]=C,n[S+6]=C,n[S+7]=C);for(var B=0;B<8;++B)b=n[B],x=n[B+8],y=n[B+16],k=n[B+24],F=n[B+32],q=n[B+40],I=n[B+48],A=n[B+56],0!=(x|y|k|F|q|I|A)?(u=(r=4112+((r=c*b+2048>>12)+(u=c*F+2048>>12)+1>>1))-u,C=(p=y)*l+(m=I)*h+2048>>12,p=p*h-m*l+2048>>12,m=C,d=(g=(g=f*(x-A)+2048>>12)+(d=q)+1>>1)-d,v=(w=(w=f*(x+A)+2048>>12)+(v=k)+1>>1)-v,C=g*o+w*a+2048>>12,g=g*a-w*o+2048>>12,w=C,C=v*s+d*i+2048>>12,v=v*i-d*s+2048>>12,A=(r=r+m+1>>1)-w,x=(u=u+p+1>>1)+(d=C),I=u-d,y=(p=u-p)+v,q=p-v,k=(m=r-m)+g,F=m-g,b=(b=r+w)<16?0:b>=4080?255:b>>4,x=x<16?0:x>=4080?255:x>>4,y=y<16?0:y>=4080?255:y>>4,k=k<16?0:k>=4080?255:k>>4,F=F<16?0:F>=4080?255:F>>4,q=q<16?0:q>=4080?255:q>>4,I=I<16?0:I>=4080?255:I>>4,A=A<16?0:A>=4080?255:A>>4,L[t+B]=b,L[t+B+8]=x,L[t+B+16]=y,L[t+B+24]=k,L[t+B+32]=F,L[t+B+40]=q,L[t+B+48]=I,L[t+B+56]=A):(C=(C=c*b+8192>>14)<-2040?0:C>=2024?255:C+2056>>4,L[t+B]=C,L[t+B+8]=C,L[t+B+16]=C,L[t+B+24]=C,L[t+B+32]=C,L[t+B+40]=C,L[t+B+48]=C,L[t+B+56]=C)}function v(e,t){for(var n=t.blocksPerLine,r=t.blocksPerColumn,i=new Int16Array(64),s=0;s<r;s++)for(var a=0;a<n;a++){var o=p(t,s,a);g(t,o,i)}return t.blockData}function d(e){return e<=0?0:e>=255?255:e}var w=e.klass({parse:function(e){function t(){var t=e[o]<<8|e[o+1];return o+=2,t}function n(){var n=t(),r=e.subarray(o,o+n-2);return o+=r.length,r}function i(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),r=0;r<e.components.length;r++){O=e.components[r];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*O.h/e.maxH),s=Math.ceil(Math.ceil(e.scanLines/8)*O.v/e.maxV),a=t*O.h,o=n*O.v,h=64*o*(a+1);O.blockData=new Int16Array(h),O.blocksPerLine=i,O.blocksPerColumn=s}e.mcusPerLine=t,e.mcusPerColumn=n}var s,a,o=0,h=(e.length,null),l=null,c=[],f=[],p=[],g=t();if(65496!==g)throw"SOI not found";for(g=t();65497!==g;){var d,w,b;switch(g){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var x=n();65504===g&&74===x[0]&&70===x[1]&&73===x[2]&&70===x[3]&&0===x[4]&&(h={version:{major:x[5],minor:x[6]},densityUnits:x[7],xDensity:x[8]<<8|x[9],yDensity:x[10]<<8|x[11],thumbWidth:x[12],thumbHeight:x[13],thumbData:x.subarray(14,14+3*x[12]*x[13])}),65518===g&&65===x[0]&&100===x[1]&&111===x[2]&&98===x[3]&&101===x[4]&&(l={version:x[5]<<8|x[6],flags0:x[7]<<8|x[8],flags1:x[9]<<8|x[10],transformCode:x[11]});break;case 65499:for(var y,k=t(),F=k+o-2;o<F;){var q=e[o++],I=new Uint16Array(64);if(q>>4==0)for(w=0;w<64;w++)y=r[w],I[y]=e[o++];else{if(q>>4!=1)throw"DQT: invalid table spec";for(w=0;w<64;w++)y=r[w],I[y]=t()}c[15&q]=I}break;case 65472:case 65473:case 65474:if(s)throw"Only single frame JPEGs supported";t(),(s={}).extended=65473===g,s.progressive=65474===g,s.precision=e[o++],s.scanLines=t(),s.samplesPerLine=t(),s.components=[],s.componentIds={};var A,C=e[o++],D=0,L=0;for(d=0;d<C;d++){A=e[o];var S=e[o+1]>>4,B=15&e[o+1];D<S&&(D=S),L<B&&(L=B);var T=e[o+2];b=s.components.push({h:S,v:B,quantizationTable:c[T]}),s.componentIds[A]=b-1,o+=3}s.maxH=D,s.maxV=L,i(s);break;case 65476:var R=t();for(d=2;d<R;){var P=e[o++],G=new Uint8Array(16),M=0;for(w=0;w<16;w++,o++)M+=G[w]=e[o];var J=new Uint8Array(M);for(w=0;w<M;w++,o++)J[w]=e[o];d+=17+M,(P>>4==0?p:f)[15&P]=u(G,J)}break;case 65501:t(),a=t();break;case 65498:t();var O,U=e[o++],E=[];for(d=0;d<U;d++){var j=s.componentIds[e[o++]];O=s.components[j];var N=e[o++];O.huffmanTableDC=p[N>>4],O.huffmanTableAC=f[15&N],E.push(O)}var H=e[o++],V=e[o++],Y=e[o++],_=m(e,o,s,E,a,H,V,Y>>4,15&Y);o+=_;break;case 65535:255!==e[o]&&o--;break;default:if(255===e[o-3]&&e[o-2]>=192&&e[o-2]<=254){o-=3;break}throw"unknown JPEG marker "+g.toString(16)}g=t()}for(this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=h,this.adobe=l,this.components=[],d=0;d<s.components.length;d++)O=s.components[d],this.components.push({output:v(s,O),scaleX:O.h/s.maxH,scaleY:O.v/s.maxV,blocksPerLine:O.blocksPerLine,blocksPerColumn:O.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(e,t){var n,r,i,s,a,o,h,l,c,f,u,p=this.width/e,m=this.height/t,g=0,v=this.components.length,d=e*t*v,w=new Uint8Array(d),b=new Uint32Array(e);for(h=0;h<v;h++){for(n=this.components[h],r=n.scaleX*p,i=n.scaleY*m,g=h,u=n.output,s=n.blocksPerLine+1<<3,a=0;a<e;a++)l=0|a*r,b[a]=(4294967288&l)<<3|7&l;for(o=0;o<t;o++)for(f=s*(4294967288&(l=0|o*i))|(7&l)<<3,a=0;a<e;a++)w[g]=u[f+b[a]],g+=v}var x=this.decodeTransform;if(x)for(h=0;h<d;)for(l=0,c=0;l<v;l++,h++,c+=2)w[h]=(w[h]*x[c]>>8)+x[c+1];return w},_isColorConversionNeeded:function(){return!(!this.adobe||!this.adobe.transformCode)||3===this.numComponents},_convertYccToRgb:function(e){for(var t,n,r,i=0,s=e.length;i<s;i+=3)t=e[i],n=e[i+1],r=e[i+2],e[i]=d(t-179.456+1.402*r),e[i+1]=d(t+135.459-.344*n-.714*r),e[i+2]=d(t-226.816+1.772*n);return e},_convertYcckToRgb:function(e){for(var t,n,r,i,s=0,a=0,o=e.length;a<o;a+=4){t=e[a],n=e[a+1],r=e[a+2],i=e[a+3];var h=n*(-660635669420364e-19*n+.000437130475926232*r-54080610064599e-18*t+.00048449797120281*i-.154362151871126)-122.67195406894+r*(-.000957964378445773*r+.000817076911346625*t-.00477271405408747*i+1.53380253221734)+t*(.000961250184130688*t-.00266257332283933*i+.48357088451265)+i*(-.000336197177618394*i+.484791561490776),l=107.268039397724+n*(219927104525741e-19*n-.000640992018297945*r+.000659397001245577*t+.000426105652938837*i-.176491792462875)+r*(-.000778269941513683*r+.00130872261408275*t+.000770482631801132*i-.151051492775562)+t*(.00126935368114843*t-.00265090189010898*i+.25802910206845)+i*(-.000318913117588328*i-.213742400323665),c=n*(-.000570115196973677*n-263409051004589e-19*r+.0020741088115012*t-.00288260236853442*i+.814272968359295)-20.810012546947+r*(-153496057440975e-19*r-.000132689043961446*t+.000560833691242812*i-.195152027534049)+t*(.00174418132927582*t-.00255243321439347*i+.116935020465145)+i*(-.000343531996510555*i+.24165260232407);e[s++]=d(h),e[s++]=d(l),e[s++]=d(c)}return e},_convertYcckToCmyk:function(e){for(var t,n,r,i=0,s=e.length;i<s;i+=4)t=e[i],n=e[i+1],r=e[i+2],e[i]=d(434.456-t-1.402*r),e[i+1]=d(119.541-t+.344*n+.714*r),e[i+2]=d(481.816-t-1.772*n);return e},_convertCmykToRgb:function(e){for(var t,n,r,i,s=0,a=-16581375,o=0,h=e.length;o<h;o+=4){t=e[o],n=e[o+1],r=e[o+2],i=e[o+3];var l=t*(-4.387332384609988*t+54.48615194189176*n+18.82290502165302*r+212.25662451639585*i-72734.4411664936)+n*(1.7149763477362134*n-5.6096736904047315*r-17.873870861415444*i-1401.7366389350734)+r*(-2.5217340131683033*r-21.248923337353073*i+4465.541406466231)-i*(21.86122147463605*i+48317.86113160301),c=t*(8.841041422036149*t+60.118027045597366*n+6.871425592049007*r+31.159100130055922*i-20220.756542821975)+n*(-15.310361306967817*n+17.575251261109482*r+131.35250912493976*i-48691.05921601825)+r*(4.444339102852739*r+9.8632861493405*i-6341.191035517494)-i*(20.737325471181034*i+47890.15695978492),f=t*(.8842522430003296*t+8.078677503112928*n+30.89978309703729*r-.23883238689178934*i-3616.812083916688)+n*(10.49593273432072*n+63.02378494754052*r+50.606957656360734*i-28620.90484698408)+r*(.03296041114873217*r+115.60384449646641*i-49363.43385999684)-i*(22.33816807309886*i+45932.16563550634);e[s++]=l>=0?255:l<=a?0:255+l*(1/255/255)|0,e[s++]=c>=0?255:c<=a?0:255+c*(1/255/255)|0,e[s++]=f>=0?255:f<=a?0:255+f*(1/255/255)|0}return e},getData:function(e,t,n){if(this.numComponents>4)throw"Unsupported color mode";var r=this._getLinearizedBlockData(e,t);if(3===this.numComponents)return this._convertYccToRgb(r);if(4===this.numComponents){if(this._isColorConversionNeeded())return n?this._convertYcckToRgb(r):this._convertYcckToCmyk(r);if(n)return this._convertCmykToRgb(r)}return r}});var b=t.inherit({klassName:"JpegStream",init:function(e,t,n){this.dict=t,this.isAdobeImage=!1,this.colorTransform=t.get("ColorTransform")||-1,function(e){for(var t=Math.max(e.length-16,1024),n=0;n<t;++n){if(255==e[n]&&238==e[n+1]&&0==e[n+2]&&14==e[n+3]&&65==e[n+4]&&100==e[n+5]&&111==e[n+6]&&98==e[n+7]&&101==e[n+8]&&0==e[n+9])return!0;if(255==e[n]&&192==e[n+1])break}return!1}(e)&&(this.isAdobeImage=!0,e=function(e){var t=new Uint8Array([255,236,0,8,69,77,66,69,68,0]),n=new Uint8Array(e.length+t.length);return n.set(e,t.length),n[0]=e[0],n[1]=e[1],n.set(t,2),n}(e)),this.bytes=e,this.overrided()},ensureBuffer:function(e){if(!this.bufferLength)try{var t=new w;-1!=this.colorTransform&&(t.colorTransform=this.colorTransform),t.parse(this.bytes);var n=t.width,r=t.height,i=t.getData(n,r);this.buffer=i,this.bufferLength=i.length}catch(e){error("JPEG error: "+e)}},getIR:function(){return bytesToString(this.bytes)},getChar:function(){error("internal error: getChar is not valid on JpegStream")},isNativelySupported:function(e,t){var n=ColorSpace.parse(this.dict.get("ColorSpace","CS"),e,t);return"DeviceGray"===n.name||"DeviceRGB"===n.name||"DeviceCMYK"===n.name&&!this.isAdobeImage&&this.colorTransform<1},isNativelyDecodable:function(e,t){var n=ColorSpace.parse(this.dict.get("ColorSpace","CS"),e,t),r=n.numComps;return 1==r||3==r}});return n.jpeg={JpegImage:w,JpegStream:b}}),e("skylark-utils-codec/jpx",["skylark-langx/langx","skylark-utils-stream/DecodeStream","./codec"],function(e,t,n){"use strict";var r=function(){function e(e){for(var t=1,n=0;e>t;)t<<=1,n++;return n}(function(){function t(t,n){var r=e(Math.max(t,n))+1;this.levels=[];for(var i=0;i<r;i++){var s={width:t,height:n,items:[]};this.levels.push(s),t=Math.ceil(t/2),n=Math.ceil(n/2)}}t.prototype={reset:function(e,t){for(var n=0,r=0;n<this.levels.length;){var i=this.levels[n],s=e+t*i.width;if(s in i.items){r=i.items[s];break}i.index=s,e>>=1,t>>=1,n++}n--;var i=this.levels[n];i.items[i.index]=r,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];if(--e<0)return this.value=n,!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]=n,!0}}})(),function(){function t(t,n,r){var i=e(Math.max(t,n))+1;this.levels=[];for(var s=0;s<i;s++){for(var a=new Uint8Array(t*n),o=0,h=a.length;o<h;o++)a[o]=r;var l={width:t,height:n,items:a};this.levels.push(l),t=Math.ceil(t/2),n=Math.ceil(n/2)}}t.prototype={reset:function(e,t,n){for(var r=0;r<this.levels.length;){var i=this.levels[r],s=e+t*i.width;i.index=s;var a=i.items[s];if(255==a)break;if(a>n)return this.currentLevel=r,this.propagateValues(),!1;e>>=1,t>>=1,r++}return this.currentLevel=r-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];--e>=0;){var t=this.levels[e];t.items[t.index]=n}},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];if(t.items[t.index]=255,--e<0)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]=n,!0}}}(),function(){var e=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];function t(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}t.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255==e[t]){var n=e[t+1];n>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(t){var n=e[t.index].qe;if(this.a-=n,this.chigh<n){var r=this.exchangeLps(t);return this.renormD(),r}if(this.chigh-=n,0==(32768&this.a)){var r=this.exchangeMps(t);return this.renormD(),r}return t.mps},renormD:function(){do{0===this.ct&&this.byteIn(),this.a<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&this.a))},exchangeMps:function(t){var n,r=e[t.index];return this.a<r.qe?(n=1-t.mps,1==r.switchFlag&&(t.mps=1-t.mps),t.index=r.nlps):(n=t.mps,t.index=r.nmps),n},exchangeLps:function(t){var n,r=e[t.index];return this.a<r.qe?(this.a=r.qe,n=t.mps,t.index=r.nmps):(this.a=r.qe,n=1-t.mps,1==r.switchFlag&&(t.mps=1-t.mps),t.index=r.nlps),n}}}(),function(){var e=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),t=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),n=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);function r(e,t,n,r){return n?r?e?t?-1:0:-1:e&&t?0:1:e?t?-1:1:0}var i=[{contextLabel:13,xorBit:0},{contextLabel:12,xorBit:0},{contextLabel:11,xorBit:0},{contextLabel:10,xorBit:0},{contextLabel:9,xorBit:0},{contextLabel:10,xorBit:1},{contextLabel:11,xorBit:1},{contextLabel:12,xorBit:1},{contextLabel:13,xorBit:1}];function s(r,i,s,a){this.width=r,this.height=i,this.contextLabelTable="HH"==s?n:"HL"==s?t:e;var o=r*i;this.neighborsSignificance=new Uint8Array(o),this.coefficentsSign=new Uint8Array(o),this.coefficentsMagnitude=new Uint32Array(o),this.processingFlags=new Uint8Array(o);for(var h=new Uint8Array(this.width*this.height),l=0,c=h.length;l<c;l++)h[l]=a;this.bitsDecoded=h,this.reset()}s.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.uniformContext={index:46,mps:0},this.runLengthContext={index:3,mps:0},this.contexts=[],this.contexts.push({index:4,mps:0});for(var e=1;e<=16;e++)this.contexts.push({index:0,mps:0})},setNeighborsSignificance:function(e,t){var n=this.neighborsSignificance,r=this.width,i=this.height,s=e*r+t;e>0&&(t>0&&(n[s-r-1]+=16),t+1<r&&(n[s-r+1]+=16),n[s-r]+=4),e+1<i&&(t>0&&(n[s+r-1]+=16),t+1<r&&(n[s+r+1]+=16),n[s+r]+=4),t>0&&(n[s-1]+=1),t+1<r&&(n[s+1]+=1),n[s]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,r=this.coefficentsMagnitude,i=this.coefficentsSign,s=(this.contextLabels,this.neighborsSignificance),a=this.processingFlags,o=this.contexts,h=this.contextLabelTable,l=this.bitsDecoded,c=0,f=t*n;c<f;c++)a[c]&=-2;for(var u=0;u<n;u+=4)for(var p=0;p<t;p++)for(var m=u*t+p,g=0;g<4;g++,m+=t){var v=u+g;if(v>=n)break;if(!r[m]&&s[m]){var d=h[s[m]],w=o[d],b=e.readBit(w);if(b){var x=this.decodeSignBit(v,p);i[m]=x,r[m]=1,this.setNeighborsSignificance(v,p),a[m]|=2}l[m]++,a[m]|=1}}},decodeSignBit:function(e,t){var n=this.width,s=this.height,a=e*n+t,o=this.coefficentsMagnitude,h=this.coefficentsSign,l=r(t>0&&o[a-1],h[a-1],t+1<n&&o[a+1],h[a+1]),c=r(e>0&&o[a-n],h[a-n],e+1<s&&o[a+n],h[a+n]),f=i[3*(1-l)+(1-c)],u=f.contextLabel,p=this.contexts[u],m=this.decoder.readBit(p);return m^f.xorBit},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,n=this.height,r=this.coefficentsMagnitude,i=this.neighborsSignificance,s=this.contexts,a=this.bitsDecoded,o=this.processingFlags,h=0;h<n;h+=4)for(var l=0;l<t;l++)for(var c=0;c<4;c++){var f=h+c;if(f>=n)break;var u=f*t+l;if(r[u]&&0==(1&o[u])){var p=16;if(0!=(2&o[u])){o[f*t+l]^=2;var m=i[u],g=(3&m)+(m>>2&3)+(m>>4&7);p=g>=1?15:14}var v=s[p],d=e.readBit(v);r[u]=r[u]<<1|d,a[u]++,o[u]|=1}}},runCleanupPass:function(){for(var e=this.decoder,t=this.width,n=this.height,r=this.neighborsSignificance,i=(this.significanceState,this.coefficentsMagnitude),s=this.coefficentsSign,a=this.contexts,o=this.contextLabelTable,h=this.bitsDecoded,l=this.processingFlags,c=t,f=2*t,u=3*t,p=0;p<n;p+=4)for(var m=0;m<t;m++){var g,v,d=p*t+m,w=p+3<n&&0===l[d]&&0===l[d+c]&&0===l[d+f]&&0===l[d+u]&&0===r[d]&&0===r[d+c]&&0===r[d+f]&&0===r[d+u],b=0,x=d;if(w){g=this.runLengthContext;var y=e.readBit(g);if(!y){h[d]++,h[d+c]++,h[d+f]++,h[d+u]++;continue}g=this.uniformContext,b=e.readBit(g)<<1|e.readBit(g),v=p+b,x+=b*t;var k=this.decodeSignBit(v,m);s[x]=k,i[x]=1,this.setNeighborsSignificance(v,m),l[x]|=2,x=d;for(var F=p;F<=v;F++,x+=t)h[x]++;b++}for(;b<4&&!((v=p+b)>=n);b++,x+=t)if(!i[x]&&0==(1&l[x])){var q=o[r[x]];g=a[q];var I=e.readBit(g);if(1==I){var k=this.decodeSignBit(v,m);s[x]=k,i[x]=1,this.setNeighborsSignificance(v,m),l[x]|=2}h[x]++}}},checkSegmentationSymbol:function(){var e=this.decoder,t=this.uniformContext,n=e.readBit(t)<<3|e.readBit(t)<<2|e.readBit(t)<<1|e.readBit(t);if(10!=n)throw"Invalid segmentation symbol"}}}();var t=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var r=e[0],i=1,s=e.length,a=1;i<s;i+=3,a++)r=this.iterate(r,e[i],e[i+1],e[i+2],t,n);return r},e.prototype.expand=function(e,t,n){var r=t-1,i=t+1,s=t+n-2,a=t+n;e[r--]=e[i++],e[a++]=e[s--],e[r--]=e[i++],e[a++]=e[s--],e[r--]=e[i++],e[a++]=e[s--],e[r--]=e[i++],e[a++]=e[s--]},e.prototype.iterate=function(e,t,n,r,i,s){for(var a=e.width,o=e.height,h=e.items,l=t.width,c=t.height,f=t.items,u=n.width,p=n.height,m=n.items,g=r.width,v=r.height,d=r.items,w=a+l,b=o+p,x=new Float32Array(w*b),y=0,k=o;y<k;y++)for(var F=y*a,q=2*y*w,I=0,A=a;I<A;I++,F++,q+=2)x[q]=h[F];for(var y=0,k=c;y<k;y++)for(var F=y*l,q=2*y*w+1,I=0,A=l;I<A;I++,F++,q+=2)x[q]=f[F];for(var y=0,k=p;y<k;y++)for(var F=y*u,q=(2*y+1)*w,I=0,A=u;I<A;I++,F++,q+=2)x[q]=m[F];for(var y=0,k=v;y<k;y++)for(var F=y*g,q=(2*y+1)*w+1,I=0,A=g;I<A;I++,F++,q+=2)x[q]=d[F];for(var C=new Float32Array(Math.max(w,b)+8),D=new Float32Array(C),L=new Float32Array(C),S=0;S<b;S++)if(1!=w){for(var F=S*w,q=4,B=0;B<w;B++,F++,q++)D[q]=x[F];this.expand(D,4,w),this.filter(D,4,w,i,L),F=S*w,q=4;for(var B=0;B<w;B++,F++,q++)x[F]=L[q]}else i%1!=0&&(x[S*w]/=2);for(var B=0;B<w;B++)if(1!=b){for(var F=B,q=4,S=0;S<b;S++,F+=w,q++)D[q]=x[F];this.expand(D,4,b),this.filter(D,4,b,s,L),F=B,q=4;for(var S=0;S<b;S++,F+=w,q++)x[F]=L[q]}else s%1!=0&&(x[B]/=2);return{width:w,height:b,items:x}},e}();(function(){function e(){t.call(this)}e.prototype=Object.create(t.prototype),e.prototype.filter=function(e,t,n,r,i){for(var s=Math.floor(r/2),a=Math.floor((r+n)/2),o=t-r%1,h=1.230174104914001,l=o-2,c=s-1,f=a+2;c<f;c++,l+=2)i[l]=h*e[l];for(var l=o-3,c=s-2,f=a+2;c<f;c++,l+=2)i[l]=.8128930661159609*e[l];for(var l=o-2,c=s-1,f=a+2;c<f;c++,l+=2)i[l]-=.443506852043971*(i[l-1]+i[l+1]);for(var l=o-1,c=s-1,f=a+1;c<f;c++,l+=2)i[l]-=.882911075530934*(i[l-1]+i[l+1]);for(var l=o,c=s,f=a+1;c<f;c++,l+=2)i[l]-=-.052980118572961*(i[l-1]+i[l+1]);for(var l=o+1,c=s,f=a;c<f;c++,l+=2)i[l]-=-1.586134342059924*(i[l-1]+i[l+1])}})(),function(){function e(){t.call(this)}e.prototype=Object.create(t.prototype),e.prototype.filter=function(e,t,n,r,i){for(var s=Math.floor(r/2),a=Math.floor((r+n)/2),o=t-r%1,h=s,l=a+1,c=o;h<l;h++,c+=2)i[c]=e[c]-Math.floor((e[c-1]+e[c+1]+2)/4);for(var h=s,l=a,c=o+1;h<l;h++,c+=2)i[c]=e[c]+Math.floor((i[c-1]+i[c+1])/2)}}()}(),i=t.inherit({klassName:"JpxStream",init:function(e,t){this.dict=t,this.bytes=e,this.overrided()},ensureBuffer:function(e){if(!this.bufferLength){var t=new r;t.parse(this.bytes);var n=t.width,i=t.height,s=t.componentsCount;1!=s&&3!=s&&4!=s&&error("JPX with "+s+" components is not supported");for(var a=new Uint8Array(n*i*s),o=0,h=t.tiles.length;o<h;o++){var l,c,f,u,p,m,g,v=t.tiles[o],d=v[0].width,w=v[0].height,b=v[0].left,x=v[0].top;switch(s){case 1:f=v[0].items,l=n*x+b,g=n-d,c=0;for(var y=0;y<w;y++){for(var k=0;k<d;k++)a[l++]=f[c++];l+=g}break;case 3:f=v[0].items,u=v[1].items,p=v[2].items,l=3*(n*x+b),g=3*(n-d),c=0;for(var y=0;y<w;y++){for(var k=0;k<d;k++)a[l++]=f[c],a[l++]=u[c],a[l++]=p[c],c++;l+=g}break;case 4:f=v[0].items,u=v[1].items,p=v[2].items,m=v[3].items,l=4*(n*x+b),g=4*(n-d),c=0;for(var y=0;y<w;y++){for(var k=0;k<d;k++)a[l++]=f[c],a[l++]=u[c],a[l++]=p[c],a[l++]=m[c],c++;l+=g}}}this.buffer=a,this.bufferLength=a.length}},getChar:function(){error("internal error: getChar is not valid on JpxStream")}});return n.jpx={JpxImage:r,JpxStream:i}}),e("skylark-utils-codec/main",["./codec","./base64","./jbig2","./jpeg","./jpx"],function(e){return e}),e("skylark-utils-codec",["skylark-utils-codec/main"],function(e){return e})}(n),!i){var o=r("skylark-langx/skylark");s?module.exports=o:t.skylarkjs=o}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-utils-codec.js.map
