/**
 * skylark-utils-codec - The codec features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(factory,globals){var define=globals.define,require=globals.require,isAmd="function"==typeof define&&define.amd,isCmd=!isAmd&&"undefined"!=typeof exports;if(!isAmd&&!define){var map={};define=globals.define=function(e,t,r){"function"==typeof r?(map[e]={factory:r,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var r=t.split("/"),n=e.split("/");r.pop();for(var i=0;i<n.length;i++)"."!=n[i]&&(".."==n[i]?r.pop():r.push(n[i]));return r.join("/")}(t,e)}),exports:null},require(e)):map[e]=r},require=globals.require=function(e){if(!map.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var t=map[e];if(!t.exports){var r=[];t.deps.forEach(function(e){r.push(require(e))}),t.exports=t.factory.apply(globals,r)}return t.exports}}if(!define)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(define,require){define("skylark-langx/skylark",[],function(){return{}}),define("skylark-langx/types",[],function(){var e,t={}.toString,r=(e={},"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(t){e["[object "+t+"]"]=t.toLowerCase()}),function(r){return null==r?String(r):e[t.call(r)]||"object"});function n(e){var t;for(t in e)if(null!==e[t])return!1;return!0}function i(e){return"function"==r(e)}function s(e){return e&&e instanceof Node}function a(e){return"object"==r(e)}function o(e){return"string"==typeof e}function u(e){return e&&e==e.window}return{isArray:function(e){return e&&e.constructor===Array},isArrayLike:function(e){return!o(e)&&!s(e)&&"number"==typeof e.length&&!i(e)},isBoolean:function(e){return"boolean"==typeof e},isDefined:function(e){return void 0!==e},isDocument:function(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE},isEmpty:n,isEmptyObject:n,isFunction:i,isHtmlNode:s,isNull:function(e){return"null"===r(e)},isNumber:function(e){return"number"==typeof e},isObject:a,isPlainObject:function(e){return a(e)&&!u(e)&&Object.getPrototypeOf(e)==Object.prototype},isString:o,isSameOrigin:function(e){if(e){var t=location.protocol+"//"+location.hostname;return location.port&&(t+=":"+location.port),e.startsWith(t)}},isSymbol:function(e){return"symbol"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag},isUndefined:function(e){return void 0===e},isWindow:u,type:r}}),define("skylark-langx/arrays",["./types"],function(e,t){var r=Array.prototype.filter,n=e.isArrayLike;function i(e,t,r,n){for(var i=e.length,s=r+(n?1:-1);n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}function s(e){return e!=e}function a(e){if(n(e)){for(var t=[],r=0;r<e.length;r++){var i=e[r];if(n(i))for(var s=0;s<i.length;s++)t.push(i[s]);else t.push(i)}return t}return e}return{baseFindIndex:i,baseIndexOf:function(e,t,r){if(t!=t)return i(e,s,r);var n=r-1,a=e.length;for(;++n<a;)if(e[n]===t)return n;return-1},compact:function(e){return r.call(e,function(e){return null!=e})},first:function(e,t){return t?e.slice(0,t):e[0]},flatten:a,inArray:function(e,t){if(!t)return-1;var r;if(t.indexOf)return t.indexOf(e);r=t.length;for(;r--;)if(t[r]===e)return r;return-1},makeArray:function(e,t,r){if(n(e))return(r||[]).concat(Array.prototype.slice.call(e,t||0));return[e]},map:function(e,t){var r,i,s,o=[];if(n(e))for(i=0;i<e.length;i++)null!=(r=t.call(e[i],e[i],i))&&o.push(r);else for(s in e)null!=(r=t.call(e[s],e[s],s))&&o.push(r);return a(o)},uniq:function(e){return r.call(e,function(t,r){return e.indexOf(t)==r})}}}),define("skylark-langx/numbers",["./types"],function(e){var t=e.isObject,r=e.isSymbol,n=1/0,i=1.7976931348623157e308,s=NaN,a=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;function h(e){if(!e)return 0===e?e:0;if((e=f(e))===n||e===-n){var t=e<0?-1:1;return t*i}return e==e?e:0}function f(e){if("number"==typeof e)return e;if(r(e))return s;if(t(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=t(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var i=u.test(e);return i||c.test(e)?l(e.slice(2),i?2:8):o.test(e)?s:+e}return{toFinite:h,toNumber:f,toInteger:function(e){var t=h(e),r=t%1;return t==t?r?t-r:t:0}}}),define("skylark-langx/objects",["./types","./numbers"],function(e,t){var r,n,i=Object.prototype.hasOwnProperty,s=Array.prototype.slice,a=e.isBoolean,o=e.isFunction,u=e.isObject,c=e.isPlainObject,l=e.isArray,h=e.isArrayLike,f=e.isString,p=t.toInteger;var d,v,m="undefined"!=typeof Symbol?Symbol.prototype:null;function g(e){if(!u(e))return[];var t=[];for(var r in e)t.push(r);return t}function y(e,t){if(!l(t))return null!=e&&i.call(e,t);for(var r=t.length,n=0;n<r;n++){var s=t[n];if(null==e||!i.call(e,s))return!1;e=e[s]}return!!r}function b(e,t,r,n){for(var i in t)n&&void 0!==e[i]||(r&&(c(t[i])||l(t[i]))?(c(t[i])&&!c(e[i])&&(e[i]={}),l(t[i])&&!l(e[i])&&(e[i]=[]),b(e[i],t[i],r,n)):void 0!==t[i]&&(e[i]=t[i]));return e}function x(e){var t=s.call(arguments,0),r=t.shift(),n=!1;return a(t[t.length-1])&&(n=t.pop()),{target:r,sources:t,deep:n}}function w(){var e=x.apply(this,arguments);return e.sources.forEach(function(t){b(e.target,t,e.deep,!1)}),e.target}function k(e){for(var t=_.keys(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=e[t[i]];return n}return r=function(e,t,r,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var s=typeof e;return("function"===s||"object"===s||"object"==typeof t)&&n(e,t,r,i)},n=function(e,t,n,i){var s=toString.call(e);if(s!==toString.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return m.valueOf.call(e)===m.valueOf.call(t)}var a="[object Array]"===s;if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var u=e.constructor,c=t.constructor;if(u!==c&&!(o(u)&&u instanceof u&&o(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],i=i||[];for(var l=n.length;l--;)if(n[l]===e)return i[l]===t;if(n.push(e),i.push(t),a){if((l=e.length)!==t.length)return!1;for(;l--;)if(!r(e[l],t[l],n,i))return!1}else{var h,f=Object.keys(e);if(l=f.length,Object.keys(t).length!==l)return!1;for(;l--;)if(h=f[l],void 0===t[h]||!r(e[h],t[h],n,i))return!1}return n.pop(),i.pop(),!0},{allKeys:g,clone:function e(t,r){var n;if(void 0===t||null===t)n=t;else if(r&&t.clone)n=t.clone();else if(l(t)){n=[];for(var i=0;i<t.length;i++)n.push(e(t[i]))}else if(c(t))for(var s in n={},t)n[s]=e(t[s]);else n=t;return n},defaults:(d=g,v=!0,function(e){var t=arguments.length;if(v&&(e=Object(e)),t<2||null==e)return e;for(var r=1;r<t;r++)for(var n=arguments[r],i=d(n),s=i.length,a=0;a<s;a++){var o=i[a];v&&void 0!==e[o]||(e[o]=n[o])}return e}),each:function(e,t){var r,n,i,s;if(e)if(void 0===(r=e.length)){for(n in e)if(e.hasOwnProperty(n)&&(s=e[n],!1===t.call(s,n,s)))break}else for(i=0;i<r&&(s=e[i],!1!==t.call(s,i,s));i++);return this},extend:function(e){var t,r=s.call(arguments,1);"boolean"==typeof e&&(t=e,e=r.shift());0==r.length&&(r=[e],e=this);return r.forEach(function(r){w(e,r,t)}),e},has:y,isEqual:function(e,t){return r(e,t)},includes:function(e,t,r,n){e=h(e)?e:k(e),r=r&&!n?p(r):0;var i=e.length;r<0&&(r=nativeMax(i+r,0));return f(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&baseIndexOf(e,t,r)>-1},isMatch:function(e,t){var r=r(t),n=r.length;if(null==e)return!n;for(var i=Object(e),s=0;s<n;s++){var a=r[s];if(t[a]!==i[a]||!(a in i))return!1}return!0},keys:function(e){if(u(e))return[];var t=[];for(var r in e)y(e,r)&&t.push(r);return t},mixin:w,removeItem:function(e,t){if(l(e)){var r=e.indexOf(t);-1!=r&&e.splice(r,1)}else if(c(e))for(var n in e)if(e[n]==t){delete e[n];break}return this},result:function(e,t,r){l(t)||(t=[t]);var n=t.length;if(!n)return o(r)?r.call(e):r;for(var i=0;i<n;i++){var s=null==e?void 0:e[t[i]];void 0===s&&(s=r,i=n),e=o(s)?s.call(e):s}return e},safeMixin:function(){var e=x.apply(this,arguments);return e.sources.forEach(function(t){b(e.target,t,e.deep,!0)}),e.target},values:k}}),define("skylark-langx/klass",["./arrays","./objects","./types"],function(e,t,r){var n=e.uniq,i=t.has,s=t.mixin,a=r.isArray,o=r.isDefined;var u=function(){function e(){return this._construct?this._construct.apply(this,arguments):this.init?this.init.apply(this,arguments):void 0}return function t(u,c,l,h){a(c)&&(h=l,l=c,c=null),c=c||Object,o(l)&&!a(l)&&(h=l,l=!1);var f=c;l&&(l=function(e,t){var r=[];return t.forEach(function(e){if(i(e,"__mixins__"))throw new Error("nested mixins");for(var t=[];e;)t.unshift(e),e=e.superclass;r=r.concat(t)}),(r=(r=n(r)).filter(function(t){for(var r=e;r;){if(t===r)return!1;if(i(r,"__mixins__"))for(var n=r.__mixins__,s=0;s<n.length;s++)if(n[s]===t)return!1;r=r.superclass}return!0})).length>0&&r}(f,l)),l&&(f=function(e,t){for(var r=e,n=0;n<t.length;n++){var i=new Function;i.prototype=Object.create(r.prototype),i.__proto__=r,i.superclass=null,s(i.prototype,t[n].prototype),i.prototype.__mixin__=t[n],r=i}return r}(f,l));var p=u.klassName||"",d=new Function("return function "+p+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.superclass=c,d.__proto__=f,d._constructor||(d._constructor=e),l&&(d.__mixins__=l),d.partial||(d.partial=function(e,t){return function(e,t,n){var i=e.prototype,s=e.superclass.prototype,a=n&&n.noOverrided;n&&n.overrides;for(var o in t)if("constructor"!==o){var u=t[o];"function"==typeof t[o]?i[o]=u._constructor||a||"function"!=typeof s[o]?u:function(e,t,r){return function(){var e=this.overrided;this.overrided=r;var n=t.apply(this,arguments);return this.overrided=e,n}}(0,u,s[o]):r.isPlainObject(u)&&null!==u&&u.get?Object.defineProperty(i,o,u):i[o]=u}return e}(this,e,t)}),d.inherit||(d.inherit=function(e,r,n){return t(e,this,r,n)}),d.partial(u,h),d}}();return u}),define("skylark-langx/ArrayStore",["./klass"],function(e){var t=function(e){if(!e)return e;var r=!!e.then;function n(n){e[n]=function(){var i=arguments,s=Deferred.when(e,function(e){return t(Array.prototype[n].apply(e,i))});if("forEach"!==n||r)return s}}return r&&(e=Object.delegate(e)),n("forEach"),n("filter"),n("map"),null==e.total&&(e.total=Deferred.when(e,function(e){return e.length})),e},r=e({klassName:"ArrayStore",queryEngine:function(e,t){switch(typeof e){default:throw new Error("Can not query with a "+typeof e);case"object":case"undefined":var r=e;e=function(e){for(var t in r){var n=r[t];if(n&&n.test){if(!n.test(e[t],e))return!1}else if(n!=e[t])return!1}return!0};break;case"string":if(!this[e])throw new Error("No filter function "+e+" was found in store");e=this[e];case"function":}function n(r){var n=function(e,t,r){var n,i=0,s=e&&e.length||0,a=[];s&&"string"==typeof e&&(e=e.split(""));"string"==typeof t&&(t=cache[t]||buildFn(t));if(r)for(;i<s;++i)n=e[i],t.call(r,n,i,e)&&a.push(n);else for(;i<s;++i)n=e[i],t(n,i,e)&&a.push(n);return a}(r,e),i=t&&t.sort;if(i&&n.sort("function"==typeof i?i:function(e,t){for(var r,n=0;r=i[n];n++){var s=e[r.attribute],a=t[r.attribute];if(s=null!=s?s.valueOf():s,a=null!=a?a.valueOf():a,s!=a)return!!r.descending==(null==s||s>a)?-1:1}return 0}),t&&(t.start||t.count)){var s=n.length;(n=n.slice(t.start||0,(t.start||0)+(t.count||1/0))).total=s}return n}return n.matches=e,n},idProperty:"id",get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,t){var r=this.data,n=this.index,i=this.idProperty,s=e[i]=t&&"id"in t?t.id:i in e?e[i]:Math.random();if(s in n){if(t&&!1===t.overwrite)throw new Error("Object already exists");r[n[s]]=e}else n[s]=r.push(e)-1;return s},add:function(e,t){return(t=t||{}).overwrite=!1,this.put(e,t)},remove:function(e){var t=this.index,r=this.data;if(e in t)return r.splice(t[e],1),this.setData(r),!0},query:function(e,r){return t(this.queryEngine(e,r)(this.data))},setData:function(e){e.items?(this.idProperty=e.identifier||this.idProperty,e=this.data=e.items):this.data=e,this.index={};for(var t=0,r=e.length;t<r;t++)this.index[e[t][this.idProperty]]=t},init:function(e){for(var t in e)this[t]=e[t];this.setData(this.data||[])}});return r}),define("skylark-langx/aspect",[],function(){var e,t=0;function r(r){return function(n,i,s,a){var o,u=n[i];u&&u.target==n||(n[i]=o=function(){for(var r=t,n=arguments,i=o.before;i;)n=i.advice.apply(this,n)||n,i=i.next;if(o.around)var s=o.around.advice(this,n);for(var a=o.after;a&&a.id<r;){if(a.receiveArguments){var u=a.advice.apply(this,n);s=u===e?s:u}else s=a.advice.call(this,s,n);a=a.next}return s},u&&(o.around={advice:function(e,t){return u.apply(e,t)}}),o.target=n);var c=function(e,r,n,i){var s,a=e[r],o="around"==r;if(o){var u=n(function(){return a.advice(this,arguments)});s={remove:function(){u&&(u=e=n=null)},advice:function(e,t){return u?u.apply(e,t):a.advice(e,t)}}}else s={remove:function(){if(s.advice){var t=s.previous,i=s.next;i||t?(t?t.next=i:e[r]=i,i&&(i.previous=t)):delete e[r],e=n=s.advice=null}},id:t++,advice:n,receiveArguments:i};if(a&&!o)if("after"==r){for(;a.next&&(a=a.next););a.next=s,s.previous=a}else"before"==r&&(e[r]=s,s.next=a,a.previous=s);else e[r]=s;return s}(o||u,r,s,a);return s=null,c}}return{after:r("after"),around:r("around"),before:r("before")}}),define("skylark-langx/funcs",["./objects","./types"],function(e,t){var r=e.mixin,n=Array.prototype.slice,i=t.isFunction,s=t.isString;var a=function(){function e(){}return function(t,n){e.prototype=t;var i=new e;return e.prototype=null,n&&r(i,n),i}}();return{debounce:function(e,t){var r;return function(){var n=this,i=arguments;r&&clearTimeout(r),r=setTimeout(function(){r=null,e.apply(n,i)},t)}},delegate:a,defer:function(e){requestAnimationFrame?requestAnimationFrame(e):setTimeoutout(e);return this},noop:function(){},proxy:function e(t,r){var a=2 in arguments&&n.call(arguments,2);if(i(t)){return function(){return t.apply(r,a?a.concat(n.call(arguments)):arguments)}}if(s(r))return a?(a.unshift(t[r],t),e.apply(null,a)):e(t[r],t);throw new TypeError("expected function")},returnTrue:function(){return!0},returnFalse:function(){return!1}}}),define("skylark-langx/Deferred",["./arrays","./funcs","./objects"],function(e,t,r){"use strict";var n=Symbol?Symbol():"__pglisteners",i=Symbol?Symbol():"__pgnotifies",s=Array.prototype.slice,a=t.proxy,o=e.makeArray,u=r.result,c=r.mixin;c(Promise.prototype,{always:function(e){return this.then(e,e),this},done:function(){for(var e=0;e<arguments.length;e++)this.then(arguments[e]);return this},fail:function(e){return this.catch(e),this}});var l=function(){var e=this,t=this.promise=new Promise(function(t,r){e._resolve=t,e._reject=r});h(t,e),this[n]=[],this[i]=[]};function h(e,t){var r={state:function(){return t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},then:function(e,t,r){return r&&this.progress(r),h(Promise.prototype.then.call(this,e&&function(t){return t&&void 0!==t.__ctx__?e.apply(t.__ctx__,t):e(t)},t&&function(e){return e&&void 0!==e.__ctx__?t.apply(e.__ctx__,e):t(e)}))},progress:function(e){return t[i].forEach(function(t){e(t)}),t[n].push(e),this}};return r.pipe=r.then,c(e,r)}return l.prototype.resolve=function(e){var t=s.call(arguments);return this.resolveWith(null,t)},l.prototype.resolveWith=function(e,t){return(t=t?o(t):[]).__ctx__=e,this._resolve(t),this._resolved=!0,this},l.prototype.notify=function(e){try{return this[i].push(e),this[n].forEach(function(t){return t(e)})}catch(e){this.reject(e)}return this},l.prototype.reject=function(e){var t=s.call(arguments);return this.rejectWith(null,t)},l.prototype.rejectWith=function(e,t){return(t=t?o(t):[]).__ctx__=e,this._reject(t),this._rejected=!0,this},l.prototype.isResolved=function(){return!!this._resolved},l.prototype.isRejected=function(){return!!this._rejected},l.prototype.then=function(e,t,r){var n=u(this,"promise");return n.then(e,t,r)},l.prototype.progress=function(e){var t=u(this,"promise");return t.progress(e)},l.prototype.catch=function(e){var t=u(this,"promise");return t.catch(e)},l.prototype.done=function(){var e=u(this,"promise");return e.done.apply(e,arguments)},l.prototype.fail=function(e){var t=u(this,"promise");return t.fail(e)},l.all=function(e){var t=new l;return Promise.all(e).then(t.resolve.bind(t),t.reject.bind(t)),u(t,"promise")},l.first=function(e){return h(Promise.race(e))},l.when=function(e,t,r,n){var i=e&&"function"==typeof e.then,s=i&&e instanceof Promise;if(!i)return arguments.length>1?t?t(e):e:(new l).resolve(e);if(!s){var o=new l(e.cancel);e.then(a(o.resolve,o),a(o.reject,o),o.notify),e=o.promise}return t||r||n?e.then(t,r,n):e},l.reject=function(e){var t=new l;return t.reject(e),t.promise},l.immediate=l.resolve=function(e){var t=new l;return t.resolve.apply(t,arguments),t.promise},l}),define("skylark-langx/async",["./Deferred","./objects"],function(e,t){var r=t.each,n={parallel:function(t,n,i){var s=[];return i=i||null,n=n||[],r(t,function(e,t){s.push(t.apply(i,n))}),e.all(s)},series:function(t,n,i){var s=[],a=new e,o=a.promise;return i=i||null,n=n||[],a.resolve(),r(t,function(e,t){o=o.then(function(){return t.apply(i,n)}),s.push(o)}),e.all(s)},waterful:function(t,n,i){var s=new e,a=s.promise;return i=i||null,n=n||[],s.resolveWith(i,n),r(t,function(e,t){a=a.then(t)}),a}};return n}),define("skylark-langx/datetimes",[],function(){return{parseMilliSeconds:function(e){var t=e.split(" "),r=parseInt(t[0]);if(isNaN(r))return 0;switch(t[1].trim().replace(/\./g,"")){case"minutes":case"minute":case"min":case"mm":case"m":return 6e4*r;case"hours":case"hour":case"HH":case"hh":case"h":case"H":return 36e5*r;case"seconds":case"second":case"sec":case"ss":case"s":return 1e3*r;case"days":case"day":case"DD":case"dd":case"d":return 864e5*r;case"months":case"month":case"MM":case"M":return 24192e5*r;case"weeks":case"week":case"W":case"w":return 6048e5*r;case"years":case"year":case"yyyy":case"yy":case"y":return 31536e6*r;default:return 0}}}}),define("skylark-langx/Evented",["./klass","./arrays","./objects","./types"],function(e,t,r,n){var i=Array.prototype.slice,s=t.compact,a=n.isDefined,o=n.isPlainObject,u=n.isFunction,c=n.isString,l=n.isEmptyObject,h=r.mixin,f=e({on:function(e,t,r,n,i,s){var a=this,l=this._hub||(this._hub={});return o(e)?(i=n,each(e,function(e,n){a.on(e,t,r,n,i,s)}),this):(c(t)||u(n)||(i=n,n=r,r=t,t=void 0),u(r)&&(i=n,n=r,r=null),c(e)&&(e=e.split(/\s/)),e.forEach(function(e){(l[e]||(l[e]=[])).push({fn:n,selector:t,data:r,ctx:i,one:s})}),this)},one:function(e,t,r,n,i){return this.on(e,t,r,n,i,1)},trigger:function(e){if(!this._hub)return this;var t=this;c(e)&&(e=new CustomEvent(e)),Object.defineProperty(e,"target",{value:this});var r=i.call(arguments,1);return r=a(r)?[e].concat(r):[e],[e.type||e.name,"all"].forEach(function(n){var i=t._hub[n];if(i){for(var a=i.length,o=!1,u=0;u<a;u++){var c=i[u];e.data?c.data&&(e.data=h({},c.data,e.data)):e.data=c.data||null,c.fn.apply(c.ctx,r),c.one&&(i[u]=null,o=!0)}o&&(t._hub[n]=s(i))}}),this},listened:function(e){var t=(this._hub||(this._events={}))[e]||[];return t.length>0},listenTo:function(e,t,r,n){if(!e)return this;c(r)&&(r=this[r]),n?e.one(t,r,this):e.on(t,r,this);for(var i,s=this._listeningTo||(this._listeningTo=[]),a=0;a<s.length;a++)if(s[a].obj==e){i=s[a];break}i||s.push(i={obj:e,events:{}});var o=i.events,u=o[t]=o[t]||[];return-1==u.indexOf(r)&&u.push(r),this},listenToOnce:function(e,t,r){return this.listenTo(e,t,r,1)},off:function(e,t){var r=this._hub||(this._hub={});return c(e)&&(e=e.split(/\s/)),e.forEach(function(e){var n=r[e],i=[];if(n&&t)for(var s=0,a=n.length;s<a;s++)n[s].fn!==t&&n[s].fn._!==t&&i.push(n[s]);i.length?r[e]=i:delete r[e]}),this},unlistenTo:function(e,t,r){var n=this._listeningTo;if(!n)return this;for(var i=0;i<n.length;i++){var a=n[i];if(!e||e==a.obj){var o=a.events;for(var u in o)if(!t||t==u){for(var c=o[u],h=0;h<c.length;h++)r&&r!=c[i]||(a.obj.off(u,c[i],this),c[i]=null);c=o[u]=s(c),l(c)&&(o[u]=null)}l(o)&&(n[i]=null)}}return n=this._listeningTo=s(n),l(n)&&(this._listeningTo=null),this}});return f}),define("skylark-langx/strings",[],function(){var e=0;return{camelCase:function(e){return e.replace(/-([\da-z])/g,function(e){return e.toUpperCase().replace("-","")})},dasherize:function(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()},deserializeValue:function(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?JSON.parse(e):e):e}catch(t){return e}},lowerFirst:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},serializeValue:function(e){return JSON.stringify(e)},substitute:function(e,t,r,n){function i(e,t){if(e.match(/\./)){var r,n=function(e,t){var i=e.pop();return i?t[i]?n(e,r=t[i]):null:r};return n(e.split(".").reverse(),t)}return t[e]}return n=n||window,r=r?proxy(n,r):function(e){return e},e.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(e,s,a){var o=i(s,t);return a&&(o=i(a,n).call(n,o,s)),r(o,s).toString()})},trim:function(e){return null==e?"":String.prototype.trim.call(e)},uniqueId:function(t){var r=++e+"";return t?t+r:r},upperFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}}),define("skylark-langx/Xhr",["./arrays","./Deferred","./Evented","./objects","./funcs","./types"],function(arrays,Deferred,Evented,objects,funcs,types){var each=objects.each,mixin=objects.mixin,noop=funcs.noop,isArray=types.isArray,isFunction=types.isFunction,isPlainObject=types.isPlainObject,type=types.type,getAbsoluteUrl=function(e){return a||(a=document.createElement("a")),a.href=e,a.href},a,Xhr=function(){var jsonpID=0,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/,XhrDefaultOptions={async:!0,type:"GET",beforeSend:noop,success:noop,error:noop,complete:noop,context:null,global:!0,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,xhrFields:{withCredentials:!0}};function mimeToDataType(e){if(e&&(e=e.split(";",2)[0]),e){if(e==htmlType)return"html";if(e==jsonType)return"json";if(scriptTypeRE.test(e))return"script";if(xmlTypeRE.test(e))return"xml"}return"text"}function appendQuery(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.data=e.data||e.query,e.processData&&e.data&&"string"!=type(e.data)&&(e.data=param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=appendQuery(e.url,e.data),e.data=void 0)}function serialize(e,t,r,n){var i,s=isArray(t),a=isPlainObject(t);each(t,function(t,o){i=type(o),n&&(t=r?n:n+"["+(a||"object"==i||"array"==i?t:"")+"]"),!n&&s?e.add(o.name,o.value):"array"==i||!r&&"object"==i?serialize(e,o,r,t):e.add(t,o)})}var param=function(e,t){var r=[];return r.add=function(e,t){isFunction(t)&&(t=t()),null==t&&(t=""),this.push(escape(e)+"="+escape(t))},serialize(r,e,t),r.join("&").replace(/%20/g,"+")},Xhr=Evented.inherit({klassName:"Xhr",_request:function(args){var _=this._,self=this,options=mixin({},XhrDefaultOptions,_.options,args),xhr=_.xhr=new XMLHttpRequest;serializeData(options);var dataType=options.dataType||options.handleAs,mime=options.mimeType||options.accepts[dataType],headers=options.headers,xhrFields=options.xhrFields,isFormData=options.data&&options.data instanceof FormData,basicAuthorizationToken=options.basicAuthorizationToken,type=options.type,url=options.url,async=options.async,user=options.user,password=options.password,deferred=new Deferred,contentType=!isFormData&&"application/x-www-form-urlencoded";if(xhrFields)for(name in xhrFields)xhr[name]=xhrFields[name];mime&&mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),mime&&xhr.overrideMimeType&&xhr.overrideMimeType(mime);var finish=function(){xhr.onloadend=noop,xhr.onabort=noop,xhr.onprogress=noop,xhr.ontimeout=noop,xhr=null},onloadend=function(){var result,error=!1;if(xhr.status>=200&&xhr.status<300||304==xhr.status||0==xhr.status&&getAbsoluteUrl(url).startsWith("file:")){dataType=dataType||mimeToDataType(options.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{"script"==dataType?eval(result):"xml"==dataType?result=xhr.responseXML:"json"==dataType?result=blankRE.test(result)?null:JSON.parse(result):"blob"==dataType?result=Blob([xhrObj.response]):"arraybuffer"==dataType&&(result=xhr.reponse)}catch(e){error=e}error?deferred.reject(error,xhr.status,xhr):deferred.resolve(result,xhr.status,xhr)}else deferred.reject(new Error(xhr.statusText),xhr.status,xhr);finish()},onabort=function(){deferred&&deferred.reject(new Error("abort"),xhr.status,xhr),finish()},ontimeout=function(){deferred&&deferred.reject(new Error("timeout"),xhr.status,xhr),finish()},onprogress=function(e){deferred&&deferred.notify(e,xhr.status,xhr)};if(xhr.onloadend=onloadend,xhr.onabort=onabort,xhr.ontimeout=ontimeout,xhr.onprogress=onprogress,xhr.open(type,url,async,user,password),headers)for(var key in headers){var value=headers[key];"content-type"===key.toLowerCase()?contentType=headers[hdr]:xhr.setRequestHeader(key,value)}return contentType&&!1!==contentType&&xhr.setRequestHeader("Content-Type",contentType),headers&&"X-Requested-With"in headers||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),basicAuthorizationToken&&xhr.setRequestHeader("Authorization",basicAuthorizationToken),xhr.send(options.data?options.data:null),deferred.promise},abort:function(){var e=this._,t=e.xhr;t&&t.abort()},request:function(e){return this._request(e)},get:function(e){return(e=e||{}).type="GET",this._request(e)},post:function(e){return(e=e||{}).type="POST",this._request(e)},patch:function(e){return(e=e||{}).type="PATCH",this._request(e)},put:function(e){return(e=e||{}).type="PUT",this._request(e)},del:function(e){return(e=e||{}).type="DELETE",this._request(e)},init:function(e){this._={options:e||{}}}});return["request","get","post","put","del","patch"].forEach(function(e){Xhr[e]=function(t,r){var n=new Xhr({url:t});return n[e](r)}}),Xhr.defaultOptions=XhrDefaultOptions,Xhr.param=param,Xhr}();return Xhr}),define("skylark-langx/Restful",["./Evented","./objects","./strings","./Xhr"],function(e,t,r,n){var i=t.mixin,s=r.substitute,a=e.inherit({klassName:"Restful",idAttribute:"id",getBaseUrl:function(e){var t=s(this.baseEndpoint,e),r=this.server+this.basePath+t;return void 0!==e[this.idAttribute]&&(r=r+"/"+e[this.idAttribute]),r},_head:function(e){},_get:function(e){return n.get(this.getBaseUrl(e),e)},_post:function(e,t){var r=this.getBaseUrl(e);return t&&(r=r+"/"+t),n.post(r,e)},_put:function(e,t){var r=this.getBaseUrl(e);return t&&(r=r+"/"+t),n.put(r,e)},_delete:function(e){var t=this.getBaseUrl(e);return n.del(t)},_patch:function(e){var t=this.getBaseUrl(e);return n.patch(t,e)},query:function(e){return this._post(e)},retrieve:function(e){return this._get(e)},create:function(e){return this._post(e)},update:function(e){return this._put(e)},delete:function(e){return this._delete(e)},patch:function(e){return this._patch(e)},init:function(e){i(this,e)}});return a}),define("skylark-langx/Stateful",["./Evented","./strings","./objects"],function(e,t,r){var n=r.isEqual,i=r.mixin,s=r.result,a=r.isEmptyObject,o=r.clone,u=t.uniqueId,c=e.inherit({_construct:function(e,t){var r=e||{};t||(t={}),this.cid=u(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{});var n=s(this,"defaults");r=i({},n,r),this.set(r,t),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(e){return o(this.attributes)},get:function(e){return this.attributes[e]},has:function(e){return null!=this.get(e)},set:function(e,t,r){if(null==e)return this;var i;if("object"==typeof e?(i=e,r=t):(i={})[e]=t,r||(r={}),!this._validate(i,r))return!1;var s=r.unset,a=r.silent,u=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=o(this.attributes),this.changed={});var l=this.attributes,h=this.changed,f=this._previousAttributes;for(var p in i)t=i[p],n(l[p],t)||u.push(p),n(f[p],t)?delete h[p]:h[p]=t,s?delete l[p]:l[p]=t;if(this.idAttribute in i&&(this.id=this.get(this.idAttribute)),!a){u.length&&(this._pending=r);for(var d=0;d<u.length;d++)this.trigger("change:"+u[d],this,l[u[d]],r)}if(c)return this;if(!a)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,i({},e,{unset:!0}))},hasChanged:function(e){return null==e?!a(this.changed):void 0!==this.changed[e]},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&o(this.changed);var t=this._changing?this._previousAttributes:this.attributes,r={};for(var i in e){var s=e[i];n(t[i],s)||(r[i]=s)}return!a(r)&&r},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return o(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return!r||(this.trigger("invalid",this,r,i(t,{validationError:r})),!1)}});return c}),define("skylark-langx/langx",["./skylark","./arrays","./ArrayStore","./aspect","./async","./datetimes","./Deferred","./Evented","./funcs","./klass","./numbers","./objects","./Restful","./Stateful","./strings","./types","./Xhr"],function(e,t,r,n,i,s,a,o,u,c,l,h,f,p,d,v,m){"use strict";Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter;var g=h.mixin,y=h.safeMixin,b=v.isFunction;var x=1;function w(){return w}return g(w,{createEvent:function(e,t){var r=new CustomEvent(e,t);return y(r,t)},funcArg:function(e,t,r,n){return b(t)?t.call(e,r,n):t},getQueryParams:function(e){var t=(e=e||window.location.href).split("?"),r={};t.length>1&&t[1].split("&").forEach(function(e){var t=e.split("=");r[t[0]]=t[1]});return r},toPixel:function(e){return parseFloat(e)||0},uid:function(e){return e._uid||(e._uid=x++)},URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),g(w,t,n,s,u,l,h,d,v,{ArrayStore:r,async:i,Deferred:a,Evented:o,klass:c,Restful:f,Stateful:p,Xhr:m}),e.langx=w}),define("skylark-utils-codec/codec",["skylark-langx/skylark","skylark-langx/langx"],function(e,t){var r=e.codec={};return r}),define("skylark-utils-codec/base64",["skylark-langx/langx","./codec"],function(e,t){var r=function(){return r},n="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";return r.encode=function(e){for(var t=[],r=e.length,s=r%3,a=r-s,o=0;o<a;){var u=e[o++]<<16|e[o++]<<8|e[o++];t.push(i.charAt(u>>>18&63)),t.push(i.charAt(u>>>12&63)),t.push(i.charAt(u>>>6&63)),t.push(i.charAt(63&u))}switch(s){case 2:var u=e[o++]<<16|e[o++]<<8;t.push(i.charAt(u>>>18&63)),t.push(i.charAt(u>>>12&63)),t.push(i.charAt(u>>>6&63)),t.push(n);break;case 1:var u=e[o++]<<16;t.push(i.charAt(u>>>18&63)),t.push(i.charAt(u>>>12&63)),t.push(n),t.push(n)}return t.join("")},r.decode=function(e){for(var t=e.split(""),r=[],s=t.length;t[--s]==n;);for(var a=0;a<s;){var o=i.indexOf(t[a++])<<18;a<=s&&(o|=i.indexOf(t[a++])<<12),a<=s&&(o|=i.indexOf(t[a++])<<6),a<=s&&(o|=i.indexOf(t[a++])),r.push(o>>>16&255),r.push(o>>>8&255),r.push(255&o)}for(;0==r[r.length-1];)r.pop();return r},t.base64=r}),define("skylark-utils-stream/streams",["skylark-langx/skylark","skylark-langx/langx"],function(e,t){var r=function(){return r};return t.mixin(r,{Stream:Stream,DecodeStream:DecodeStream}),e.streams=r}),define("skylark-utils-stream/Stream",["skylark-langx/skylark","skylark-langx/langx","./streams"],function(e,t,r){var n=t.Evented.inherit({klassName:"Stream",init:function(e,t,r,n){this.bytes=new Uint8Array(e),this.start=t||0,this.pos=this.start,this.end=t+r||this.bytes.length,this.dict=n},length:{get:function(){return this.end-this.start}},getByte:function(){return this.pos>=this.end?null:this.bytes[this.pos++]},getBytes:function(e){var t=this.bytes,r=this.pos,n=this.end;if(!e)return t.subarray(r,n);var i=r+e;return i>n&&(i=n),this.pos=i,t.subarray(r,i)},lookChar:function(){return this.pos>=this.end?null:String.fromCharCode(this.bytes[this.pos])},getChar:function(){return this.pos>=this.end?null:String.fromCharCode(this.bytes[this.pos++])},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=this.start},moveStart:function(){this.start=this.pos},makeSubStream:function(e,t,r){return new n(this.bytes.buffer,e,t,r)},isStream:!0});return r.Stream=n}),define("skylark-utils-stream/DecodeStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./Stream"],function(e,t,r,n){var i=n.inherit({klassName:"DecodeStream",init:function(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null},ensureBuffer:function(e){var t=this.buffer,r=t?t.byteLength:0;if(e<r)return t;for(var n=512;n<e;)n<<=1;for(var i=new Uint8Array(n),s=0;s<r;++s)i[s]=t[s];return this.buffer=i},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var t,r=this.pos;if(e){for(this.ensureBuffer(r+e),t=r+e;!this.eof&&this.bufferLength<t;)this.readBlock();var n=this.bufferLength;t>n&&(t=n)}else{for(;!this.eof;)this.readBlock();(t=this.bufferLength)||(this.buffer=new Uint8Array(0))}return this.pos=t,this.buffer.subarray(r,t)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,t,r){for(var i=e+t;this.bufferLength<=i&&!this.eof;)this.readBlock();return new n(this.buffer,e,t,r)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}});return stream.DecodeStream=i}),define("skylark-utils-codec/jbig2",["skylark-langx/langx","skylark-utils-stream/DecodeStream","./codec"],function(e,t,r){"use strict";var n=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}],i=e.klass({klassName:"ArithmeticDecoder",byteIn:function(){var e=this.data,t=this.bp;if(255==e[t]){var r=e[t+1];r>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,t){var r,i=e[t]>>1,s=1&e[t],a=n[i],o=a.qe,u=a.nmps,c=a.nlps,l=a.switchFlag;if(this.a-=o,this.chigh<o)this.a<o?(this.a=o,r=s,i=u):(this.a=o,r=1-s,l&&(s=r),i=c);else{if(this.chigh-=o,0!=(32768&this.a))return s;this.a<o?(r=1-s,l&&(s=r),i=c):(r=s,i=u)}do{0===this.ct&&this.byteIn(),this.a<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&this.a));return e[t]=i<<1|s,r},init:function(e,t,r){this.data=e,this.bp=t,this.dataEnd=r,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}}),s=e.klass({getContexts:function(e){return e in this?this[e]:this[e]=new Int8Array(65536)}}),a=e.klass({decoder:{get:function(){var e=new i(this.data,this.start,this.end);return shadow(this,"decoder",e)}},contextCache:{get:function(){var e=new s;return shadow(this,"contextCache",e)}},init:function(e,t,r){this.data=e,this.start=t,this.end=r}});function o(e,t,r){for(var n,i=e.getContexts(t),s=1,a=1,o=0,u=32,c=4436;a;){var l=r.readBit(i,s);switch(s=s<256?s<<1|l:511&(s<<1|l)|256,a){case 1:n=!!l;break;case 2:if(l)break;a=7,u=2,c=0;break;case 3:if(l)break;a=7,u=4,c=4;break;case 4:if(l)break;a=7,u=6,c=20;break;case 5:if(l)break;a=7,u=8,c=84;break;case 6:if(l)break;a=7,u=12,c=340;break;default:o=2*o+l,0==--u&&(a=0);continue}a++}return o+=c,n?o>0?-o:null:o}function u(e,t,r){for(var n=e.getContexts("IAID"),i=1,s=0;s<r;s++){var a=t.readBit(n,i);i=2*i+a}return r<31?i&(1<<r)-1:i-Math.pow(2,r)}var c=["SymbolDictionary",null,null,null,"IntermediateTextRegion",null,"ImmediateTextRegion","ImmediateLosslessTextRegion",null,null,null,null,null,null,null,null,"patternDictionary",null,null,null,"IntermediateHalftoneRegion",null,"ImmediateHalftoneRegion","ImmediateLosslessHalftoneRegion",null,null,null,null,null,null,null,null,null,null,null,null,"IntermediateGenericRegion",null,"ImmediateGenericRegion","ImmediateLosslessGenericRegion","IntermediateGenericRefinementRegion",null,"ImmediateGenericRefinementRegion","ImmediateLosslessGenericRefinementRegion",null,null,null,null,"PageInformation","EndOfPage","EndOfStripe","EndOfFile","Profiles","Tables",null,null,null,null,null,null,null,null,"Extension"],l=[[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:2,y:-1},{x:-4,y:0},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}],[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:2,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:2,y:-1},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}],[{x:-1,y:-2},{x:0,y:-2},{x:1,y:-2},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-2,y:0},{x:-1,y:0}],[{x:-3,y:-1},{x:-2,y:-1},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-4,y:0},{x:-3,y:0},{x:-2,y:0},{x:-1,y:0}]],h=[{coding:[{x:0,y:-1},{x:1,y:-1},{x:-1,y:0}],reference:[{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}]},{coding:[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0}],reference:[{x:0,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]}],f=[7379,1946,227,395],p=[32,8];function d(e){for(var t=1,r=0;e>t;)t<<=1,r++;return r}function v(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function m(e,t){var r=v(e,t);return 2147483648&r?r+4294967296:r}function g(e,t){return e[t]<<8|e[t+1]}function y(e,t){return e[t]<<24>>24}function b(e,t,r,n,i,s,a,o){e&&error("JBIG2 error: MMR encoding is not supported");for(var u=!!s,c=l[n].concat(a),h=c.length,p=new Int32Array(h),d=new Int32Array(h),v=0;v<h;v++)p[v]=c[v].x,d[v]=c[v].y;for(var m=f[n],g=[],y=o.decoder,b=o.contextCache.getContexts("GB"),x=0,w=0;w<r;w++){if(i){var k=y.readBit(b,m);x^=k}if(x)g.push(g[g.length-1]);else{var A=new Uint8Array(t);g.push(A);for(var _=0;_<t;_++)if(u&&s[w][_])A[_]=0;else{for(var q=0,v=0;v<h;v++){var F=w+d[v],S=_+p[v];F<0||S<0||S>=t?q<<=1:q=q<<1|g[F][S]}var j=y.readBit(b,q);A[_]=j}}}return g}function x(e,t,r,n,i,s,a,o,u){var c=h[r].coding;0===r&&(c=c.concat([o[0]]));for(var l=c.length,f=new Int32Array(l),d=new Int32Array(l),v=0;v<l;v++)f[v]=c[v].x,d[v]=c[v].y;var m=h[r].reference;0===r&&(m=m.concat([o[1]]));for(var g=m.length,y=new Int32Array(g),b=new Int32Array(g),v=0;v<g;v++)y[v]=m[v].x,b[v]=m[v].y;for(var x=n[0].length,w=n.length,k=p[r],A=[],_=u.decoder,q=u.contextCache.getContexts("GR"),F=0,S=0;S<t;S++){if(a){var j=_.readBit(q,k);F^=j}var T=new Uint8Array(e);A.push(T);for(var D=0;D<e;D++){F&&error("JBIG2 error: prediction is not supported");for(var C=0,v=0;v<l;v++){var I=S+d[v],O=D+f[v];I<0||O<0||O>=e?C<<=1:C=C<<1|A[I][O]}for(var v=0;v<g;v++){var I=S+b[v]+s,O=D+y[v]+i;I<0||I>=w||O<0||O>=x?C<<=1:C=C<<1|n[I][O]}var L=_.readBit(q,C);T[D]=L}}return A}function w(e,t){var r={};r.number=m(e,t);var n=e[t+4],i=63&n;c[i]||error("JBIG2 error: invalid segment type: "+i),r.type=i,r.typeName=c[i],r.deferredNonRetain=!!(128&n);var s=!!(64&n),a=e[t+5],o=a>>5&7,u=[31&a],l=t+6;if(7==a){o=536870911&v(e,l-1),l+=3;var h=o+7>>3;for(u[0]=e[l++];--h>0;)u.push(e[l++])}else 5!=a&&6!=a||error("JBIG2 error: invalid referred-to flags");r.retainBits=u;for(var f=r.number<=256?1:r.number<=65536?2:4,p=[],d=0;d<o;d++){var y=1==f?e[l]:2==f?g(e,l):m(e,l);p.push(y),l+=f}if(r.referredTo=p,s?(r.pageAssociation=m(e,l),l+=4):r.pageAssociation=e[l++],r.length=m(e,l),l+=4,4294967295==r.length)if(38===i){var b=A(e,l),x=e[l+_],w=!!(1&x),k=new Uint8Array(6);w||(k[0]=255,k[1]=172),k[2]=b.height>>>24&255,k[3]=b.height>>16&255,k[4]=b.height>>8&255,k[5]=255&b.height;for(var d=l,q=e.length;d<q;d++){for(var F=0;F<6&&k[F]===e[d+F];)F++;if(6==F){r.length=d+6;break}}4294967295==r.length&&error("JBIG2 error: segment end was not found")}else error("JBIG2 error: invalid unknown segment length");return r.headerEnd=l,r}function k(e,t,r,n){for(var i=[],s=r;s<n;){var a=w(t,s);s=a.headerEnd;var o={header:a,data:t};if(e.randomAccess||(o.start=s,s+=a.length,o.end=s),i.push(o),51==a.type)break}if(e.randomAccess)for(var u=0,c=i.length;u<c;u++)i[u].start=s,s+=i[u].header.length,i[u].end=s;return i}function A(e,t){return{width:m(e,t),height:m(e,t+4),x:m(e,t+8),y:m(e,t+12),combinationOperator:7&e[t+16]}}var _=17;function q(e,t){var r,n=e.header,i=e.data,s=e.start,a=e.end;switch(n.type){case 0:var o={},u=g(i,s);if(o.huffman=!!(1&u),o.refinement=!!(2&u),o.huffmanDHSelector=u>>2&3,o.huffmanDWSelector=u>>4&3,o.bitmapSizeSelector=u>>6&1,o.aggregationInstancesSelector=u>>7&1,o.bitmapCodingContextUsed=!!(256&u),o.bitmapCodingContextRetained=!!(512&u),o.template=u>>10&3,o.refinementTemplate=u>>12&1,s+=2,!o.huffman){for(var c=0===o.template?4:1,l=[],h=0;h<c;h++)l.push({x:y(i,s),y:y(i,s+1)}),s+=2;o.at=l}if(o.refinement&&!o.refinementTemplate){for(var l=[],h=0;h<2;h++)l.push({x:y(i,s),y:y(i,s+1)}),s+=2;o.refinementAt=l}o.numberOfExportedSymbols=m(i,s),s+=4,o.numberOfNewSymbols=m(i,s),s+=4,r=[o,n.number,n.referredTo,i,s,a];break;case 6:case 7:var f={};f.info=A(i,s);var p=g(i,s+=_);if(s+=2,f.huffman=!!(1&p),f.refinement=!!(2&p),f.stripSize=1<<(p>>2&3),f.referenceCorner=p>>4&3,f.transposed=!!(64&p),f.combinationOperator=p>>7&3,f.defaultPixelValue=p>>9&1,f.dsOffset=p<<17>>27,f.refinementTemplate=p>>15&1,f.huffman){var d=g(i,s);s+=2,f.huffmanFS=3&d,f.huffmanDS=d>>2&3,f.huffmanDT=d>>4&3,f.huffmanRefinementDW=d>>6&3,f.huffmanRefinementDH=d>>8&3,f.huffmanRefinementDX=d>>10&3,f.huffmanRefinementDY=d>>12&3,f.huffmanRefinementSizeSelector=!!(14&d)}if(f.refinement&&!f.refinementTemplate){for(var l=[],h=0;h<2;h++)l.push({x:y(i,s),y:y(i,s+1)}),s+=2;f.refinementAt=l}f.numberOfSymbolInstances=m(i,s),s+=4,f.huffman&&error("JBIG2 error: huffman is not supported"),r=[f,n.referredTo,i,s,a];break;case 38:case 39:var v={};v.info=A(i,s),s+=_;var b=i[s++];if(v.mmr=!!(1&b),v.template=b>>1&3,v.prediction=!!(8&b),!v.mmr){for(var c=0===v.template?4:1,l=[],h=0;h<c;h++)l.push({x:y(i,s),y:y(i,s+1)}),s+=2;v.at=l}r=[v,i,s,a];break;case 48:var x={width:m(i,s),height:m(i,s+4),resolutionX:m(i,s+8),resolutionY:m(i,s+12)};4294967295==x.height&&delete x.height;var w=i[s+16];g(i,s+17);x.lossless=!!(1&w),x.refinement=!!(2&w),x.defaultPixelValue=w>>2&1,x.combinationOperator=w>>3&3,x.requiresBuffer=!!(32&w),x.combinationOperatorOverride=!!(64&w),r=[x];break;case 49:case 50:case 51:case 62:break;default:error("JBIG2 error: segment type "+n.typeName+"("+n.type+") is not implemented")}var k="on"+n.typeName;k in t&&t[k].apply(t,r)}function F(e,t){for(var r=0,n=e.length;r<n;r++)q(e[r],t)}var S=e.klass({onPageInformation:function(e){this.currentPageInfo=e;for(var t=e.width+7>>3,r=new Uint8Array(t*e.height),n=e.defaultPixelValue?255:0,i=0,s=r.length;i<s;i++)r[i]=n;this.buffer=r},drawBitmap:function(e,t){for(var r=this.currentPageInfo,n=e.width,i=e.height,s=r.width+7>>3,a=r.combinationOperatorOverride?e.combinationOperator:r.combinationOperator,o=this.buffer,u=0;u<i;u++){var c=128>>(7&e.x),l=(u+e.y)*s+(e.x>>3);switch(a){case 0:for(var h=0;h<n;h++)o[l]|=t[u][h]?c:0,(c>>=1)||(c=128,l++);break;case 2:for(var h=0;h<n;h++)o[l]^=t[u][h]?c:0,(c>>=1)||(c=128,l++);break;default:error("JBIG2 error: operator "+a+" is not supported")}}},onImmediateGenericRegion:function(e,t,r,n){var i=e.info,s=new a(t,r,n),o=b(e.mmr,i.width,i.height,e.template,e.prediction,null,e.at,s);this.drawBitmap(i,o)},onImmediateLosslessGenericRegion:function(){this.onImmediateGenericRegion.apply(this,arguments)},onSymbolDictionary:function(e,t,r,n,i,s){e.huffman&&error("JBIG2 error: huffman is not supported");var c=this.symbols;c||(this.symbols=c={});for(var l=[],h=0,f=r.length;h<f;h++)l=l.concat(c[r[h]]);var p=new a(n,i,s);c[t]=function(e,t,r,n,i,s,a,c,l,h,f){e&&error("JBIG2 error: huffman is not supported");var p=[],v=0,m=d(r.length+n),g=f.decoder,y=f.contextCache;for(;p.length<n;){var w=o(y,"IADH",g);v+=w;for(var k=0;;){var A,_=o(y,"IADW",g);if(null===_)break;if(k+=_,t){var q=o(y,"IAAI",g);q>1&&error("JBIG2 error: number of instances > 1 is not supported");var F=u(y,g,m),S=o(y,"IARDX",g),j=o(y,"IARDY",g),T=F<r.length?r[F]:p[F-r.length];A=x(k,v,l,T,S,j,!1,h,f)}else A=b(!1,k,v,a,!1,null,c,f);p.push(A)}}var D=[],C=[],I=!1,O=r.length+n;for(;C.length<O;){for(var L=o(y,"IAEX",g);L--;)C.push(I);I=!I}for(var B=0,E=r.length;B<E;B++)C[B]&&D.push(r[B]);for(var P=0;P<n;B++,P++)C[B]&&D.push(p[P]);return D}(e.huffman,e.refinement,l,e.numberOfNewSymbols,e.numberOfExportedSymbols,0,e.template,e.at,e.refinementTemplate,e.refinementAt,p)},onImmediateTextRegion:function(e,t,r,n,i){for(var s=e.info,c=this.symbols,l=[],h=0,f=t.length;h<f;h++)l=l.concat(c[t[h]]);var p=d(l.length),v=new a(r,n,i),m=function(e,t,r,n,i,s,a,c,l,h,f,p,d,v,m,g,y){e&&error("JBIG2 error: huffman is not supported");for(var b=[],w=0;w<n;w++){var k=new Uint8Array(r);if(i)for(var A=0;A<r;A++)k[A]=i;b.push(k)}var _=y.decoder,q=y.contextCache,F=-o(q,"IADT",_),S=0,w=0;for(;w<s;){var j=o(q,"IADT",_);F+=j;for(var T=o(q,"IAFS",_),D=S+=T;;){var C=1==a?0:o(q,"IAIT",_),I=a*F+C,O=u(q,_,l),L=t&&o(q,"IARI",_),B=c[O],E=B[0].length,P=B.length;if(L){var R=o(q,"IARDW",_),M=o(q,"IARDH",_),U=o(q,"IARDX",_),N=o(q,"IARDY",_);B=x(E+=R,P+=M,m,B,(R>>1)+U,(M>>1)+N,!1,g,y)}var G=I-(1&p?0:P),J=D-(2&p?E:0);if(h){for(var X=0;X<P;X++){var k=b[J+X];if(k){var H=B[X],z=Math.min(r-G,E);switch(d){case 0:for(var V=0;V<z;V++)k[G+V]|=H[V];break;case 2:for(var V=0;V<z;V++)k[G+V]^=H[V];break;default:error("JBIG2 error: operator "+d+" is not supported")}}}D+=P-1}else{for(var V=0;V<P;V++){var k=b[G+V];if(k){var H=B[V];switch(d){case 0:for(var X=0;X<E;X++)k[J+X]|=H[X];break;case 2:for(var X=0;X<E;X++)k[J+X]^=H[X];break;default:error("JBIG2 error: operator "+d+" is not supported")}}}D+=E-1}w++;var W=o(q,"IADS",_);if(null===W)break;D+=W+f}}return b}(e.huffman,e.refinement,s.width,s.height,e.defaultPixelValue,e.numberOfSymbolInstances,e.stripSize,l,p,e.transposed,e.dsOffset,e.referenceCorner,e.combinationOperator,0,e.refinementTemplate,e.refinementAt,v);this.drawBitmap(s,m)},onImmediateLosslessTextRegion:function(){this.onImmediateTextRegion.apply(this,arguments)}}),j=e.klass({parseChunks:function(e){return function(e){for(var t=new S,r=0,n=e.length;r<n;r++){var i=e[r],s=k({},i.data,i.start,i.end);F(s,t)}return t.buffer}(e)}}),T=t.inherit({klassName:"Jbig2Stream",init:function(e,t){this.dict=t,this.bytes=e,this.overrided()},ensureBuffer:function(e){if(!this.bufferLength){var t=new j,r=[],n=this.dict.get("DecodeParms");if(n&&n.has("JBIG2Globals")){var i=n.get("JBIG2Globals"),s=i.getBytes();r.push({data:s,start:0,end:s.length})}r.push({data:this.bytes,start:0,end:this.bytes.length});for(var a=t.parseChunks(r),o=a.length,u=0;u<o;u++)a[u]^=255;this.buffer=a,this.bufferLength=o}},getChar:function(){error("internal error: getChar is not valid on Jbig2Stream")}});return r.jbig2={Jbig2Image:j,Jbig2Stream:T}}),define("skylark-utils-codec/jpeg",["skylark-langx/langx","skylark-utils-stream/DecodeStream","./codec"],function(e,t,r){"use strict";var n=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,s=799,a=3406,o=2276,u=1567,c=3784,l=5793,h=2896;function f(e,t){for(var r,n,i=0,s=[],a=16;a>0&&!e[a-1];)a--;s.push({children:[],index:0});var o,u=s[0];for(r=0;r<a;r++){for(n=0;n<e[r];n++){for((u=s.pop()).children[u.index]=t[i];u.index>0;)u=s.pop();for(u.index++,s.push(u);s.length<=r;)s.push(o={children:[],index:0}),u.children[u.index]=o.children,u=o;i++}r+1<a&&(s.push(o={children:[],index:0}),u.children[u.index]=o.children,u=o)}return s[0].children}function p(e,t,r){return 64*((e.blocksPerLine+1)*t+r)}function d(e,t,r,i,s,a,o,u,c){r.precision,r.samplesPerLine,r.scanLines;var l=r.mcusPerLine,h=r.progressive,f=(r.maxH,r.maxV,t),d=0,v=0;function m(){if(v>0)return d>>--v&1;if(255===(d=e[t++])){var r=e[t++];if(r)throw"unexpected marker: "+(d<<8|r).toString(16)}return v=7,d>>>7}function g(e){for(var t=e;;){if("number"==typeof(t=t[m()]))return t;if("object"!=typeof t)throw"invalid huffman sequence"}}function y(e){for(var t=0;e>0;)t=t<<1|m(),e--;return t}function b(e){if(1===e)return 1===m()?1:-1;var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var x=0;var w,k=0;function A(e,t,r,n,i){var s=r/l|0,a=r%l,o=s*e.v+n,u=a*e.h+i,c=p(e,o,u);t(e,c)}function _(e,t,r){var n=r/e.blocksPerLine|0,i=r%e.blocksPerLine,s=p(e,n,i);t(e,s)}var q,F,S,j,T,D,C=i.length;D=h?0===a?0===u?function(e,t){var r=g(e.huffmanTableDC),n=0===r?0:b(r)<<c;e.blockData[t]=e.pred+=n}:function(e,t){e.blockData[t]|=m()<<c}:0===u?function(e,t){if(x>0)return void x--;var r=a,i=o;for(;r<=i;){var s=g(e.huffmanTableAC),u=15&s,l=s>>4;if(0!==u){var h=n[r+=l];e.blockData[t+h]=b(u)*(1<<c),r++}else{if(l<15){x=y(l)+(1<<l)-1;break}r+=16}}}:function(e,t){var r,i,s=a,u=o,l=0;for(;s<=u;){var h=n[s];switch(k){case 0:if(i=g(e.huffmanTableAC),l=i>>4,0===(r=15&i))l<15?(x=y(l)+(1<<l),k=4):(l=16,k=1);else{if(1!==r)throw"invalid ACn encoding";w=b(r),k=l?2:3}continue;case 1:case 2:e.blockData[t+h]?e.blockData[t+h]+=m()<<c:0===--l&&(k=2===k?3:0);break;case 3:e.blockData[t+h]?e.blockData[t+h]+=m()<<c:(e.blockData[t+h]=w<<c,k=0);break;case 4:e.blockData[t+h]&&(e.blockData[t+h]+=m()<<c)}s++}4===k&&0===--x&&(k=0)}:function(e,t){var r=g(e.huffmanTableDC),i=0===r?0:b(r);e.blockData[t]=e.pred+=i;var s=1;for(;s<64;){var a=g(e.huffmanTableAC),o=15&a,u=a>>4;if(0!==o){var c=n[s+=u];e.blockData[t+c]=b(o),s++}else{if(u<15)break;s+=16}}};var I,O,L,B,E=0;for(O=1===C?i[0].blocksPerLine*i[0].blocksPerColumn:l*r.mcusPerColumn,s||(s=O);E<O;){for(F=0;F<C;F++)i[F].pred=0;if(x=0,1===C)for(q=i[0],T=0;T<s;T++)_(q,D,E),E++;else for(T=0;T<s;T++){for(F=0;F<C;F++)for(q=i[F],L=q.h,B=q.v,S=0;S<B;S++)for(j=0;j<L;j++)A(q,D,E,S,j);E++}if(v=0,(I=e[t]<<8|e[t+1])<=65280)throw"marker was not found";if(!(I>=65488&&I<=65495))break;t+=2}return t-f}function v(e,t,r){for(var n,f,p,d,v,m,g,y,b,x,w,k,A,_,q,F,S,j=e.quantizationTable,T=e.blockData,D=0;D<64;D+=8)b=T[t+D],x=T[t+D+1],w=T[t+D+2],k=T[t+D+3],A=T[t+D+4],_=T[t+D+5],q=T[t+D+6],F=T[t+D+7],b*=j[D],0!=(x|w|k|A|_|q|F)?(x*=j[D+1],w*=j[D+2],k*=j[D+3],A*=j[D+4],_*=j[D+5],q*=j[D+6],F*=j[D+7],f=(n=(n=l*b+128>>8)+(f=l*A+128>>8)+1>>1)-f,S=(p=w)*c+(d=q)*u+128>>8,p=p*u-d*c+128>>8,g=(v=(v=h*(x-F)+128>>8)+(g=_<<4)+1>>1)-g,m=(y=(y=h*(x+F)+128>>8)+(m=k<<4)+1>>1)-m,d=(n=n+(d=S)+1>>1)-d,p=(f=f+p+1>>1)-p,S=v*o+y*a+2048>>12,v=v*a-y*o+2048>>12,y=S,S=m*s+g*i+2048>>12,m=m*i-g*s+2048>>12,g=S,r[D]=n+y,r[D+7]=n-y,r[D+1]=f+g,r[D+6]=f-g,r[D+2]=p+m,r[D+5]=p-m,r[D+3]=d+v,r[D+4]=d-v):(S=l*b+512>>10,r[D]=S,r[D+1]=S,r[D+2]=S,r[D+3]=S,r[D+4]=S,r[D+5]=S,r[D+6]=S,r[D+7]=S);for(var C=0;C<8;++C)b=r[C],x=r[C+8],w=r[C+16],k=r[C+24],A=r[C+32],_=r[C+40],q=r[C+48],F=r[C+56],0!=(x|w|k|A|_|q|F)?(f=(n=4112+((n=l*b+2048>>12)+(f=l*A+2048>>12)+1>>1))-f,S=(p=w)*c+(d=q)*u+2048>>12,p=p*u-d*c+2048>>12,d=S,g=(v=(v=h*(x-F)+2048>>12)+(g=_)+1>>1)-g,m=(y=(y=h*(x+F)+2048>>12)+(m=k)+1>>1)-m,S=v*o+y*a+2048>>12,v=v*a-y*o+2048>>12,y=S,S=m*s+g*i+2048>>12,m=m*i-g*s+2048>>12,F=(n=n+d+1>>1)-y,x=(f=f+p+1>>1)+(g=S),q=f-g,w=(p=f-p)+m,_=p-m,k=(d=n-d)+v,A=d-v,b=(b=n+y)<16?0:b>=4080?255:b>>4,x=x<16?0:x>=4080?255:x>>4,w=w<16?0:w>=4080?255:w>>4,k=k<16?0:k>=4080?255:k>>4,A=A<16?0:A>=4080?255:A>>4,_=_<16?0:_>=4080?255:_>>4,q=q<16?0:q>=4080?255:q>>4,F=F<16?0:F>=4080?255:F>>4,T[t+C]=b,T[t+C+8]=x,T[t+C+16]=w,T[t+C+24]=k,T[t+C+32]=A,T[t+C+40]=_,T[t+C+48]=q,T[t+C+56]=F):(S=(S=l*b+8192>>14)<-2040?0:S>=2024?255:S+2056>>4,T[t+C]=S,T[t+C+8]=S,T[t+C+16]=S,T[t+C+24]=S,T[t+C+32]=S,T[t+C+40]=S,T[t+C+48]=S,T[t+C+56]=S)}function m(e,t){for(var r=t.blocksPerLine,n=t.blocksPerColumn,i=new Int16Array(64),s=0;s<n;s++)for(var a=0;a<r;a++){var o=p(t,s,a);v(t,o,i)}return t.blockData}function g(e){return e<=0?0:e>=255?255:e}var y=e.klass({parse:function(e){function t(){var t=e[o]<<8|e[o+1];return o+=2,t}function r(){var r=t(),n=e.subarray(o,o+r-2);return o+=n.length,n}function i(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),r=Math.ceil(e.scanLines/8/e.maxV),n=0;n<e.components.length;n++){R=e.components[n];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*R.h/e.maxH),s=Math.ceil(Math.ceil(e.scanLines/8)*R.v/e.maxV),a=t*R.h,o=r*R.v,u=64*o*(a+1);R.blockData=new Int16Array(u),R.blocksPerLine=i,R.blocksPerColumn=s}e.mcusPerLine=t,e.mcusPerColumn=r}var s,a,o=0,u=(e.length,null),c=null,l=[],h=[],p=[],v=t();if(65496!==v)throw"SOI not found";for(v=t();65497!==v;){var g,y,b;switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var x=r();65504===v&&74===x[0]&&70===x[1]&&73===x[2]&&70===x[3]&&0===x[4]&&(u={version:{major:x[5],minor:x[6]},densityUnits:x[7],xDensity:x[8]<<8|x[9],yDensity:x[10]<<8|x[11],thumbWidth:x[12],thumbHeight:x[13],thumbData:x.subarray(14,14+3*x[12]*x[13])}),65518===v&&65===x[0]&&100===x[1]&&111===x[2]&&98===x[3]&&101===x[4]&&(c={version:x[5]<<8|x[6],flags0:x[7]<<8|x[8],flags1:x[9]<<8|x[10],transformCode:x[11]});break;case 65499:for(var w,k=t(),A=k+o-2;o<A;){var _=e[o++],q=new Uint16Array(64);if(_>>4==0)for(y=0;y<64;y++)w=n[y],q[w]=e[o++];else{if(_>>4!=1)throw"DQT: invalid table spec";for(y=0;y<64;y++)w=n[y],q[w]=t()}l[15&_]=q}break;case 65472:case 65473:case 65474:if(s)throw"Only single frame JPEGs supported";t(),(s={}).extended=65473===v,s.progressive=65474===v,s.precision=e[o++],s.scanLines=t(),s.samplesPerLine=t(),s.components=[],s.componentIds={};var F,S=e[o++],j=0,T=0;for(g=0;g<S;g++){F=e[o];var D=e[o+1]>>4,C=15&e[o+1];j<D&&(j=D),T<C&&(T=C);var I=e[o+2];b=s.components.push({h:D,v:C,quantizationTable:l[I]}),s.componentIds[F]=b-1,o+=3}s.maxH=j,s.maxV=T,i(s);break;case 65476:var O=t();for(g=2;g<O;){var L=e[o++],B=new Uint8Array(16),E=0;for(y=0;y<16;y++,o++)E+=B[y]=e[o];var P=new Uint8Array(E);for(y=0;y<E;y++,o++)P[y]=e[o];g+=17+E,(L>>4==0?p:h)[15&L]=f(B,P)}break;case 65501:t(),a=t();break;case 65498:t();var R,M=e[o++],U=[];for(g=0;g<M;g++){var N=s.componentIds[e[o++]];R=s.components[N];var G=e[o++];R.huffmanTableDC=p[G>>4],R.huffmanTableAC=h[15&G],U.push(R)}var J=e[o++],X=e[o++],H=e[o++],z=d(e,o,s,U,a,J,X,H>>4,15&H);o+=z;break;case 65535:255!==e[o]&&o--;break;default:if(255===e[o-3]&&e[o-2]>=192&&e[o-2]<=254){o-=3;break}throw"unknown JPEG marker "+v.toString(16)}v=t()}for(this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=u,this.adobe=c,this.components=[],g=0;g<s.components.length;g++)R=s.components[g],this.components.push({output:m(s,R),scaleX:R.h/s.maxH,scaleY:R.v/s.maxV,blocksPerLine:R.blocksPerLine,blocksPerColumn:R.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(e,t){var r,n,i,s,a,o,u,c,l,h,f,p=this.width/e,d=this.height/t,v=0,m=this.components.length,g=e*t*m,y=new Uint8Array(g),b=new Uint32Array(e);for(u=0;u<m;u++){for(r=this.components[u],n=r.scaleX*p,i=r.scaleY*d,v=u,f=r.output,s=r.blocksPerLine+1<<3,a=0;a<e;a++)c=0|a*n,b[a]=(4294967288&c)<<3|7&c;for(o=0;o<t;o++)for(h=s*(4294967288&(c=0|o*i))|(7&c)<<3,a=0;a<e;a++)y[v]=f[h+b[a]],v+=m}var x=this.decodeTransform;if(x)for(u=0;u<g;)for(c=0,l=0;c<m;c++,u++,l+=2)y[u]=(y[u]*x[l]>>8)+x[l+1];return y},_isColorConversionNeeded:function(){return!(!this.adobe||!this.adobe.transformCode)||3===this.numComponents},_convertYccToRgb:function(e){for(var t,r,n,i=0,s=e.length;i<s;i+=3)t=e[i],r=e[i+1],n=e[i+2],e[i]=g(t-179.456+1.402*n),e[i+1]=g(t+135.459-.344*r-.714*n),e[i+2]=g(t-226.816+1.772*r);return e},_convertYcckToRgb:function(e){for(var t,r,n,i,s=0,a=0,o=e.length;a<o;a+=4){t=e[a],r=e[a+1],n=e[a+2],i=e[a+3];var u=r*(-660635669420364e-19*r+.000437130475926232*n-54080610064599e-18*t+.00048449797120281*i-.154362151871126)-122.67195406894+n*(-.000957964378445773*n+.000817076911346625*t-.00477271405408747*i+1.53380253221734)+t*(.000961250184130688*t-.00266257332283933*i+.48357088451265)+i*(-.000336197177618394*i+.484791561490776),c=107.268039397724+r*(219927104525741e-19*r-.000640992018297945*n+.000659397001245577*t+.000426105652938837*i-.176491792462875)+n*(-.000778269941513683*n+.00130872261408275*t+.000770482631801132*i-.151051492775562)+t*(.00126935368114843*t-.00265090189010898*i+.25802910206845)+i*(-.000318913117588328*i-.213742400323665),l=r*(-.000570115196973677*r-263409051004589e-19*n+.0020741088115012*t-.00288260236853442*i+.814272968359295)-20.810012546947+n*(-153496057440975e-19*n-.000132689043961446*t+.000560833691242812*i-.195152027534049)+t*(.00174418132927582*t-.00255243321439347*i+.116935020465145)+i*(-.000343531996510555*i+.24165260232407);e[s++]=g(u),e[s++]=g(c),e[s++]=g(l)}return e},_convertYcckToCmyk:function(e){for(var t,r,n,i=0,s=e.length;i<s;i+=4)t=e[i],r=e[i+1],n=e[i+2],e[i]=g(434.456-t-1.402*n),e[i+1]=g(119.541-t+.344*r+.714*n),e[i+2]=g(481.816-t-1.772*r);return e},_convertCmykToRgb:function(e){for(var t,r,n,i,s=0,a=-16581375,o=0,u=e.length;o<u;o+=4){t=e[o],r=e[o+1],n=e[o+2],i=e[o+3];var c=t*(-4.387332384609988*t+54.48615194189176*r+18.82290502165302*n+212.25662451639585*i-72734.4411664936)+r*(1.7149763477362134*r-5.6096736904047315*n-17.873870861415444*i-1401.7366389350734)+n*(-2.5217340131683033*n-21.248923337353073*i+4465.541406466231)-i*(21.86122147463605*i+48317.86113160301),l=t*(8.841041422036149*t+60.118027045597366*r+6.871425592049007*n+31.159100130055922*i-20220.756542821975)+r*(-15.310361306967817*r+17.575251261109482*n+131.35250912493976*i-48691.05921601825)+n*(4.444339102852739*n+9.8632861493405*i-6341.191035517494)-i*(20.737325471181034*i+47890.15695978492),h=t*(.8842522430003296*t+8.078677503112928*r+30.89978309703729*n-.23883238689178934*i-3616.812083916688)+r*(10.49593273432072*r+63.02378494754052*n+50.606957656360734*i-28620.90484698408)+n*(.03296041114873217*n+115.60384449646641*i-49363.43385999684)-i*(22.33816807309886*i+45932.16563550634);e[s++]=c>=0?255:c<=a?0:255+c*(1/255/255)|0,e[s++]=l>=0?255:l<=a?0:255+l*(1/255/255)|0,e[s++]=h>=0?255:h<=a?0:255+h*(1/255/255)|0}return e},getData:function(e,t,r){if(this.numComponents>4)throw"Unsupported color mode";var n=this._getLinearizedBlockData(e,t);if(3===this.numComponents)return this._convertYccToRgb(n);if(4===this.numComponents){if(this._isColorConversionNeeded())return r?this._convertYcckToRgb(n):this._convertYcckToCmyk(n);if(r)return this._convertCmykToRgb(n)}return n}});var b=t.inherit({klassName:"JpegStream",init:function(e,t,r){this.dict=t,this.isAdobeImage=!1,this.colorTransform=t.get("ColorTransform")||-1,function(e){for(var t=Math.max(e.length-16,1024),r=0;r<t;++r){if(255==e[r]&&238==e[r+1]&&0==e[r+2]&&14==e[r+3]&&65==e[r+4]&&100==e[r+5]&&111==e[r+6]&&98==e[r+7]&&101==e[r+8]&&0==e[r+9])return!0;if(255==e[r]&&192==e[r+1])break}return!1}(e)&&(this.isAdobeImage=!0,e=function(e){var t=new Uint8Array([255,236,0,8,69,77,66,69,68,0]),r=new Uint8Array(e.length+t.length);return r.set(e,t.length),r[0]=e[0],r[1]=e[1],r.set(t,2),r}(e)),this.bytes=e,this.overrided()},ensureBuffer:function(e){if(!this.bufferLength)try{var t=new y;-1!=this.colorTransform&&(t.colorTransform=this.colorTransform),t.parse(this.bytes);var r=t.width,n=t.height,i=t.getData(r,n);this.buffer=i,this.bufferLength=i.length}catch(e){error("JPEG error: "+e)}},getIR:function(){return bytesToString(this.bytes)},getChar:function(){error("internal error: getChar is not valid on JpegStream")},isNativelySupported:function(e,t){var r=ColorSpace.parse(this.dict.get("ColorSpace","CS"),e,t);return"DeviceGray"===r.name||"DeviceRGB"===r.name||"DeviceCMYK"===r.name&&!this.isAdobeImage&&this.colorTransform<1},isNativelyDecodable:function(e,t){var r=ColorSpace.parse(this.dict.get("ColorSpace","CS"),e,t),n=r.numComps;return 1==n||3==n}});return r.jpeg={JpegImage:y,JpegStream:b}}),define("skylark-utils-codec/jpx",["skylark-langx/langx","skylark-utils-stream/DecodeStream","./codec"],function(e,t,r){"use strict";var n=function(){function e(e){for(var t=1,r=0;e>t;)t<<=1,r++;return r}(function(){function t(t,r){var n=e(Math.max(t,r))+1;this.levels=[];for(var i=0;i<n;i++){var s={width:t,height:r,items:[]};this.levels.push(s),t=Math.ceil(t/2),r=Math.ceil(r/2)}}t.prototype={reset:function(e,t){for(var r=0,n=0;r<this.levels.length;){var i=this.levels[r],s=e+t*i.width;if(s in i.items){n=i.items[s];break}i.index=s,e>>=1,t>>=1,r++}r--;var i=this.levels[r];i.items[i.index]=n,this.currentLevel=r,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];if(--e<0)return this.value=r,!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]=r,!0}}})(),function(){function t(t,r,n){var i=e(Math.max(t,r))+1;this.levels=[];for(var s=0;s<i;s++){for(var a=new Uint8Array(t*r),o=0,u=a.length;o<u;o++)a[o]=n;var c={width:t,height:r,items:a};this.levels.push(c),t=Math.ceil(t/2),r=Math.ceil(r/2)}}t.prototype={reset:function(e,t,r){for(var n=0;n<this.levels.length;){var i=this.levels[n],s=e+t*i.width;i.index=s;var a=i.items[s];if(255==a)break;if(a>r)return this.currentLevel=n,this.propagateValues(),!1;e>>=1,t>>=1,n++}return this.currentLevel=n-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];--e>=0;){var t=this.levels[e];t.items[t.index]=r}},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],r=t.items[t.index];if(t.items[t.index]=255,--e<0)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]=r,!0}}}(),function(){var e=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];function t(e,t,r){this.data=e,this.bp=t,this.dataEnd=r,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}t.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255==e[t]){var r=e[t+1];r>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(t){var r=e[t.index].qe;if(this.a-=r,this.chigh<r){var n=this.exchangeLps(t);return this.renormD(),n}if(this.chigh-=r,0==(32768&this.a)){var n=this.exchangeMps(t);return this.renormD(),n}return t.mps},renormD:function(){do{0===this.ct&&this.byteIn(),this.a<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&this.a))},exchangeMps:function(t){var r,n=e[t.index];return this.a<n.qe?(r=1-t.mps,1==n.switchFlag&&(t.mps=1-t.mps),t.index=n.nlps):(r=t.mps,t.index=n.nmps),r},exchangeLps:function(t){var r,n=e[t.index];return this.a<n.qe?(this.a=n.qe,r=t.mps,t.index=n.nmps):(this.a=n.qe,r=1-t.mps,1==n.switchFlag&&(t.mps=1-t.mps),t.index=n.nlps),r}}}(),function(){var e=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),t=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),r=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);function n(e,t,r,n){return r?n?e?t?-1:0:-1:e&&t?0:1:e?t?-1:1:0}var i=[{contextLabel:13,xorBit:0},{contextLabel:12,xorBit:0},{contextLabel:11,xorBit:0},{contextLabel:10,xorBit:0},{contextLabel:9,xorBit:0},{contextLabel:10,xorBit:1},{contextLabel:11,xorBit:1},{contextLabel:12,xorBit:1},{contextLabel:13,xorBit:1}];function s(n,i,s,a){this.width=n,this.height=i,this.contextLabelTable="HH"==s?r:"HL"==s?t:e;var o=n*i;this.neighborsSignificance=new Uint8Array(o),this.coefficentsSign=new Uint8Array(o),this.coefficentsMagnitude=new Uint32Array(o),this.processingFlags=new Uint8Array(o);for(var u=new Uint8Array(this.width*this.height),c=0,l=u.length;c<l;c++)u[c]=a;this.bitsDecoded=u,this.reset()}s.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.uniformContext={index:46,mps:0},this.runLengthContext={index:3,mps:0},this.contexts=[],this.contexts.push({index:4,mps:0});for(var e=1;e<=16;e++)this.contexts.push({index:0,mps:0})},setNeighborsSignificance:function(e,t){var r=this.neighborsSignificance,n=this.width,i=this.height,s=e*n+t;e>0&&(t>0&&(r[s-n-1]+=16),t+1<n&&(r[s-n+1]+=16),r[s-n]+=4),e+1<i&&(t>0&&(r[s+n-1]+=16),t+1<n&&(r[s+n+1]+=16),r[s+n]+=4),t>0&&(r[s-1]+=1),t+1<n&&(r[s+1]+=1),r[s]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,r=this.height,n=this.coefficentsMagnitude,i=this.coefficentsSign,s=(this.contextLabels,this.neighborsSignificance),a=this.processingFlags,o=this.contexts,u=this.contextLabelTable,c=this.bitsDecoded,l=0,h=t*r;l<h;l++)a[l]&=-2;for(var f=0;f<r;f+=4)for(var p=0;p<t;p++)for(var d=f*t+p,v=0;v<4;v++,d+=t){var m=f+v;if(m>=r)break;if(!n[d]&&s[d]){var g=u[s[d]],y=o[g],b=e.readBit(y);if(b){var x=this.decodeSignBit(m,p);i[d]=x,n[d]=1,this.setNeighborsSignificance(m,p),a[d]|=2}c[d]++,a[d]|=1}}},decodeSignBit:function(e,t){var r=this.width,s=this.height,a=e*r+t,o=this.coefficentsMagnitude,u=this.coefficentsSign,c=n(t>0&&o[a-1],u[a-1],t+1<r&&o[a+1],u[a+1]),l=n(e>0&&o[a-r],u[a-r],e+1<s&&o[a+r],u[a+r]),h=i[3*(1-c)+(1-l)],f=h.contextLabel,p=this.contexts[f],d=this.decoder.readBit(p);return d^h.xorBit},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,r=this.height,n=this.coefficentsMagnitude,i=this.neighborsSignificance,s=this.contexts,a=this.bitsDecoded,o=this.processingFlags,u=0;u<r;u+=4)for(var c=0;c<t;c++)for(var l=0;l<4;l++){var h=u+l;if(h>=r)break;var f=h*t+c;if(n[f]&&0==(1&o[f])){var p=16;if(0!=(2&o[f])){o[h*t+c]^=2;var d=i[f],v=(3&d)+(d>>2&3)+(d>>4&7);p=v>=1?15:14}var m=s[p],g=e.readBit(m);n[f]=n[f]<<1|g,a[f]++,o[f]|=1}}},runCleanupPass:function(){for(var e=this.decoder,t=this.width,r=this.height,n=this.neighborsSignificance,i=(this.significanceState,this.coefficentsMagnitude),s=this.coefficentsSign,a=this.contexts,o=this.contextLabelTable,u=this.bitsDecoded,c=this.processingFlags,l=t,h=2*t,f=3*t,p=0;p<r;p+=4)for(var d=0;d<t;d++){var v,m,g=p*t+d,y=p+3<r&&0===c[g]&&0===c[g+l]&&0===c[g+h]&&0===c[g+f]&&0===n[g]&&0===n[g+l]&&0===n[g+h]&&0===n[g+f],b=0,x=g;if(y){v=this.runLengthContext;var w=e.readBit(v);if(!w){u[g]++,u[g+l]++,u[g+h]++,u[g+f]++;continue}v=this.uniformContext,b=e.readBit(v)<<1|e.readBit(v),m=p+b,x+=b*t;var k=this.decodeSignBit(m,d);s[x]=k,i[x]=1,this.setNeighborsSignificance(m,d),c[x]|=2,x=g;for(var A=p;A<=m;A++,x+=t)u[x]++;b++}for(;b<4&&!((m=p+b)>=r);b++,x+=t)if(!i[x]&&0==(1&c[x])){var _=o[n[x]];v=a[_];var q=e.readBit(v);if(1==q){var k=this.decodeSignBit(m,d);s[x]=k,i[x]=1,this.setNeighborsSignificance(m,d),c[x]|=2}u[x]++}}},checkSegmentationSymbol:function(){var e=this.decoder,t=this.uniformContext,r=e.readBit(t)<<3|e.readBit(t)<<2|e.readBit(t)<<1|e.readBit(t);if(10!=r)throw"Invalid segmentation symbol"}}}();var t=function(){function e(){}return e.prototype.calculate=function(e,t,r){for(var n=e[0],i=1,s=e.length,a=1;i<s;i+=3,a++)n=this.iterate(n,e[i],e[i+1],e[i+2],t,r);return n},e.prototype.expand=function(e,t,r){var n=t-1,i=t+1,s=t+r-2,a=t+r;e[n--]=e[i++],e[a++]=e[s--],e[n--]=e[i++],e[a++]=e[s--],e[n--]=e[i++],e[a++]=e[s--],e[n--]=e[i++],e[a++]=e[s--]},e.prototype.iterate=function(e,t,r,n,i,s){for(var a=e.width,o=e.height,u=e.items,c=t.width,l=t.height,h=t.items,f=r.width,p=r.height,d=r.items,v=n.width,m=n.height,g=n.items,y=a+c,b=o+p,x=new Float32Array(y*b),w=0,k=o;w<k;w++)for(var A=w*a,_=2*w*y,q=0,F=a;q<F;q++,A++,_+=2)x[_]=u[A];for(var w=0,k=l;w<k;w++)for(var A=w*c,_=2*w*y+1,q=0,F=c;q<F;q++,A++,_+=2)x[_]=h[A];for(var w=0,k=p;w<k;w++)for(var A=w*f,_=(2*w+1)*y,q=0,F=f;q<F;q++,A++,_+=2)x[_]=d[A];for(var w=0,k=m;w<k;w++)for(var A=w*v,_=(2*w+1)*y+1,q=0,F=v;q<F;q++,A++,_+=2)x[_]=g[A];for(var S=new Float32Array(Math.max(y,b)+8),j=new Float32Array(S),T=new Float32Array(S),D=0;D<b;D++)if(1!=y){for(var A=D*y,_=4,C=0;C<y;C++,A++,_++)j[_]=x[A];this.expand(j,4,y),this.filter(j,4,y,i,T),A=D*y,_=4;for(var C=0;C<y;C++,A++,_++)x[A]=T[_]}else i%1!=0&&(x[D*y]/=2);for(var C=0;C<y;C++)if(1!=b){for(var A=C,_=4,D=0;D<b;D++,A+=y,_++)j[_]=x[A];this.expand(j,4,b),this.filter(j,4,b,s,T),A=C,_=4;for(var D=0;D<b;D++,A+=y,_++)x[A]=T[_]}else s%1!=0&&(x[C]/=2);return{width:y,height:b,items:x}},e}();(function(){function e(){t.call(this)}e.prototype=Object.create(t.prototype),e.prototype.filter=function(e,t,r,n,i){for(var s=Math.floor(n/2),a=Math.floor((n+r)/2),o=t-n%1,u=1.230174104914001,c=o-2,l=s-1,h=a+2;l<h;l++,c+=2)i[c]=u*e[c];for(var c=o-3,l=s-2,h=a+2;l<h;l++,c+=2)i[c]=.8128930661159609*e[c];for(var c=o-2,l=s-1,h=a+2;l<h;l++,c+=2)i[c]-=.443506852043971*(i[c-1]+i[c+1]);for(var c=o-1,l=s-1,h=a+1;l<h;l++,c+=2)i[c]-=.882911075530934*(i[c-1]+i[c+1]);for(var c=o,l=s,h=a+1;l<h;l++,c+=2)i[c]-=-.052980118572961*(i[c-1]+i[c+1]);for(var c=o+1,l=s,h=a;l<h;l++,c+=2)i[c]-=-1.586134342059924*(i[c-1]+i[c+1])}})(),function(){function e(){t.call(this)}e.prototype=Object.create(t.prototype),e.prototype.filter=function(e,t,r,n,i){for(var s=Math.floor(n/2),a=Math.floor((n+r)/2),o=t-n%1,u=s,c=a+1,l=o;u<c;u++,l+=2)i[l]=e[l]-Math.floor((e[l-1]+e[l+1]+2)/4);for(var u=s,c=a,l=o+1;u<c;u++,l+=2)i[l]=e[l]+Math.floor((i[l-1]+i[l+1])/2)}}()}(),i=t.inherit({klassName:"JpxStream",init:function(e,t){this.dict=t,this.bytes=e,this.overrided()},ensureBuffer:function(e){if(!this.bufferLength){var t=new n;t.parse(this.bytes);var r=t.width,i=t.height,s=t.componentsCount;1!=s&&3!=s&&4!=s&&error("JPX with "+s+" components is not supported");for(var a=new Uint8Array(r*i*s),o=0,u=t.tiles.length;o<u;o++){var c,l,h,f,p,d,v,m=t.tiles[o],g=m[0].width,y=m[0].height,b=m[0].left,x=m[0].top;switch(s){case 1:h=m[0].items,c=r*x+b,v=r-g,l=0;for(var w=0;w<y;w++){for(var k=0;k<g;k++)a[c++]=h[l++];c+=v}break;case 3:h=m[0].items,f=m[1].items,p=m[2].items,c=3*(r*x+b),v=3*(r-g),l=0;for(var w=0;w<y;w++){for(var k=0;k<g;k++)a[c++]=h[l],a[c++]=f[l],a[c++]=p[l],l++;c+=v}break;case 4:h=m[0].items,f=m[1].items,p=m[2].items,d=m[3].items,c=4*(r*x+b),v=4*(r-g),l=0;for(var w=0;w<y;w++){for(var k=0;k<g;k++)a[c++]=h[l],a[c++]=f[l],a[c++]=p[l],a[c++]=d[l],l++;c+=v}}}this.buffer=a,this.bufferLength=a.length}},getChar:function(){error("internal error: getChar is not valid on JpxStream")}});return r.jpx={JpxImage:n,JpxStream:i}}),define("skylark-utils-codec/main",["./codec","./base64","./jbig2","./jpeg","./jpx"],function(e){return e}),define("skylark-utils-codec",["skylark-utils-codec/main"],function(e){return e})}(define,require),!isAmd){var skylarkjs=require("skylark-langx/skylark");isCmd?module.exports=skylarkjs:globals.skylarkjs=skylarkjs}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-utils-codec-all.js.map
